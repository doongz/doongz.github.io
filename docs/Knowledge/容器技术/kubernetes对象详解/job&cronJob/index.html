<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Knowledge/容器技术/kubernetes对象详解/job&cronJob">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">详解 Kubernetes Job 和 CronJob 的实现原理 | Doongz&#x27;s Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doongz.github.io/docs/Knowledge/容器技术/kubernetes对象详解/job&amp;cronJob"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="详解 Kubernetes Job 和 CronJob 的实现原理 | Doongz&#x27;s Site"><meta data-rh="true" name="description" content="来源：详解 Kubernetes Job 和 CronJob 的实现原理"><meta data-rh="true" property="og:description" content="来源：详解 Kubernetes Job 和 CronJob 的实现原理"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://doongz.github.io/docs/Knowledge/容器技术/kubernetes对象详解/job&amp;cronJob"><link data-rh="true" rel="alternate" href="https://doongz.github.io/docs/Knowledge/容器技术/kubernetes对象详解/job&amp;cronJob" hreflang="en"><link data-rh="true" rel="alternate" href="https://doongz.github.io/docs/Knowledge/容器技术/kubernetes对象详解/job&amp;cronJob" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Doongz&#39;s Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Doongz&#39;s Site Atom Feed">





<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.bbae31c2.css">
<link rel="preload" href="/assets/js/runtime~main.958a4673.js" as="script">
<link rel="preload" href="/assets/js/main.715bfe53.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Home page</b></a><a class="navbar__item navbar__link" href="/docs/catalogue-algo">Algorithm</a><a class="navbar__item navbar__link" href="/docs/catalogue-skill">Skill</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/catalogue-knowledge">Knowledge</a><a class="navbar__item navbar__link" href="/community/support">Community</a><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Courses</a><ul class="dropdown__menu"><li><a href="https://github.com/doongz/mlc-ai" target="_blank" rel="noopener noreferrer" class="dropdown__link">Machine Learning Compilation<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/cs229" target="_blank" rel="noopener noreferrer" class="dropdown__link">Stanford CS229: Machine Learning<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/aics" target="_blank" rel="noopener noreferrer" class="dropdown__link">中国科学院 智能计算系统<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/cs50-ai" target="_blank" rel="noopener noreferrer" class="dropdown__link">Harvard CS50’s Introduction to AI with Python<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/mit-6.824" target="_blank" rel="noopener noreferrer" class="dropdown__link">MIT-6.824 Distributed Systems<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/os-workbench" target="_blank" rel="noopener noreferrer" class="dropdown__link">南京大学 操作系统：设计与实现<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/mit-6.s081" target="_blank" rel="noopener noreferrer" class="dropdown__link">MIT-6.S081 Operating Systems Engineering<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/doongz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/catalogue-knowledge">Catalogue</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Knowledge/IC/IC">IC</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Knowledge/计算机组成/计算机组成-序">计算机组成</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Knowledge/操作系统/计算机系统概述">操作系统</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Knowledge/计算机网络/计算机网络体系结构">计算机网络</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/Knowledge/容器技术/docker原理">容器技术</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Knowledge/容器技术/docker原理">Docker 原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Knowledge/容器技术/kubernetes原理">kubernetes 原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Knowledge/容器技术/kubernetes定制特性">如何为 Kubernetes 定制特性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Knowledge/容器技术/kubernetes问题&amp;局限性">Kubernetes 的问题和局限性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Knowledge/容器技术/kubernetes集群联邦&amp;资源分发">Kubernetes 集群联邦和资源分发</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Knowledge/容器技术/kubernetes贡献指南">kubernetes 贡献指南</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/Knowledge/容器技术/kubernetes对象详解/pod">kubernetes对象详解</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Knowledge/容器技术/kubernetes对象详解/pod">详解 Kubernetes Pod 的实现原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Knowledge/容器技术/kubernetes对象详解/service">详解 Kubernetes Service 的实现原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Knowledge/容器技术/kubernetes对象详解/volume">详解 Kubernetes Volume 的实现原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Knowledge/容器技术/kubernetes对象详解/replicaSet">详解 Kubernetes ReplicaSet 的实现原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Knowledge/容器技术/kubernetes对象详解/garbage-collector">详解 Kubernetes 垃圾收集器的实现原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Knowledge/容器技术/kubernetes对象详解/deployment">详解 Kubernetes Deployment 的实现原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Knowledge/容器技术/kubernetes对象详解/statefulSet">详解 Kubernetes StatefulSet 实现原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Knowledge/容器技术/kubernetes对象详解/daemonSet">详解 Kubernetes DaemonSet 的实现原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Knowledge/容器技术/kubernetes对象详解/job&amp;cronJob">详解 Kubernetes Job 和 CronJob 的实现原理</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Knowledge/数据存储/设计数据密集型应用/序">数据存储</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Knowledge/AI/Tensor">AI</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">容器技术</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">kubernetes对象详解</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">详解 Kubernetes Job 和 CronJob 的实现原理</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>详解 Kubernetes Job 和 CronJob 的实现原理</h1><p>来源：<a href="https://draveness.me/kubernetes-job-cronjob/" target="_blank" rel="noopener noreferrer">详解 Kubernetes Job 和 CronJob 的实现原理</a></p><p>之前介绍了 Kubernetes 中用于长期提供服务的 <a href="https://draveness.me/kubernetes-replicaset" target="_blank" rel="noopener noreferrer">ReplicaSet</a>、<a href="https://draveness.me/kubernetes-deployment" target="_blank" rel="noopener noreferrer">Deployment</a>、<a href="https://draveness.me/kubernetes-statefulset" target="_blank" rel="noopener noreferrer">StatefulSet</a> 和 <a href="https://draveness.me/kubernetes-daemonset" target="_blank" rel="noopener noreferrer">DaemonSet</a> 等资源，但是作为一个容器编排引擎，任务和定时任务的支持是一个必须要支持的功能。</p><p>Kubernetes 中使用 Job 和 CronJob 两个资源分别提供了一次性任务和定时任务的特性，这两种对象也使用控制器模型来实现资源的管理，我们在这篇文章种就会介绍它们的实现原理。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一概述">一、概述<a class="hash-link" href="#一概述" title="Direct link to heading">​</a></h2><p>Kubernetes 中的 Job 可以创建并且保证一定数量 Pod 的成功停止，当 Job 持有的一个 Pod 对象成功完成任务之后，Job 就会记录这一次 Pod 的成功运行；当一定数量的Pod 的任务执行结束之后，当前的 Job 就会将它自己的状态标记成结束。</p><p><img loading="lazy" alt="k8s-31" src="data:image/png;base64,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" width="1360" height="520" class="img_ev3q"></p><p>上述图片中展示了一个 <code>spec.completions=3</code> 的任务的状态随着 Pod 的成功执行而更新和迁移状态的过程，从图中我们能比较清楚的看到 Job 和 Pod 之间的关系，假设我们有一个用于计算圆周率的如下任务：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> batch/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">completions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parallelism</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> perl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;perl&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;-Mbignum=bpi&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-wle&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;print bpi(2000)&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">restartPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Never</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">backoffLimit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当我们在 Kubernetes 中创建上述任务时，使用 <code>kubectl</code> 能够观测到以下的信息：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ k apply -f job.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">job.batch/pi created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get job --watch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME  COMPLETIONS   DURATION   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi    </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/10          1s         1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/10          36s        36s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi    </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/10          46s        46s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi    </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/10          54s        54s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi    </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">/10          60s        60s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi    </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">/10          65s        65s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi    </span><span class="token number" style="color:#36acaa">6</span><span class="token plain">/10          90s        90s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi    </span><span class="token number" style="color:#36acaa">7</span><span class="token plain">/10          99s        99s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi    </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">/10          104s       104s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi    </span><span class="token number" style="color:#36acaa">9</span><span class="token plain">/10          107s       107s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi    </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">/10         109s       109s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>由于任务 <code>pi</code> 在配置时指定了 <code>spec.completions=10</code>，所以当前的任务需要等待 10 个 Pod 的成功执行，另一个比较重要的 <code>spec.parallelism=5</code> 表示最多有多少个并发执行的任务，如果 <code>spec.parallelism=1</code> 那么所有的任务都会依次顺序执行，只有前一个任务执行成功时，后一个任务才会开始工作。</p><p><img loading="lazy" alt="k8s-32" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA5gAAAJaCAAAAABv9LdqAAAjOElEQVR42u2dv67tOHanf4kDF2C4AwdMGs4GDgYCOqzAgQECDQeOejpg5GAwwLgCwU/QgMKZqAEFkzdADzChAb2BnkAvoFwxMwZrAu3z/9xTe+tQe3Nrf19063ahmodnfeJaXBQlA4DqEFMAgJgAgJgAiAkAiAmAmACAmACICQCICQCICYCYAICYAIgJAIgJgJgAgJgAgJgAiAkAiAmAmACAmACICQCICQCICYCYAICYAIgJAIgJgJgAgJgAgJgAiAkAiAmAmACAmACICQCICQCICYCYANeP5+pBTEBMxASoQ8yDjA8xATEREwAxERMQEzEBEBMxARATADEREwAxARATMQEQEzEBMRETADERE+CKYqY4IybAjcRMMcY45Y//w6yImAA3EnNeX89qERNgEyHOeQ8xo9niNCMmwLYol3w/ph3EtFGdmaU+nv7rczciJsA5+NOlAE03LKXFTGottZLUZbO5keQQE+CcVPbVjR0uxLmkmJ0mG9Sm1Go0axVzahET4EIxJUmhLyJmE4LUmHmZWVZrWYEaE+Asf2L7P9956fpUSsx+spOO5pUnRcQE+FV3+iBJP7/R0o+5YCp7KjNXMUfEBPiaPLZu3fJpf3mlZTdfFvhniGnekcoCnMPYrlL2Y3o+CiA1MV8a+OeIOaxbPqOZd6PNDWICfMLSO0lqh6fe4mnLZ9wQ+OeImYKc1CazsZFTQEyAjymsXy3MrxSSXJc2Bf6PeX1WPXV9elqqZ+MQO8A7LaOT1PTpbfQ2Q94Y+DcCMeFIRCepnT5kndsDHzEBvsnYSHqbsn478BET4FtM52uJmADXYQmSwlI88BETYDM5SvLzDoGPmABbmRvJjbsEPmICbKSX1GdDTICKqksvNfNegY+YAFsY3Hp5AGICVENuJTftGPiICXB5GttIIRliAtSUxkob3+RQ9SAm3Gsa20lu44sciAmwk5deCvnRZwExobLy0kk904CYUBWTk0amATGhKobt5SViAuxEJzUL04CYUBM5SD4zD4gJNbF4qWMaEBPq8tKpwP2QiAlQkvHSVy8RE2B3ouTY9kFMqIrcST4xD4gJVXnppZbtWMSEqlgatmMRE2qDU3iIeZ+/o6O8yvQ5I6fwEBMxqxOTU3iIebdiHnd8nMJDTMSsb3yJU3iIiZjVjW8ufgqPq0UAMb87vlj+FB5iAmJ+b3w57LDtw/WVgJjfGt/s9jjtg5iAmN8YX+4lDcwVYiJmTeNb/E7dS8QExNw8vnj59/UQExBz3/HNfr9DeIgJiLlpfLnXju94ISYg5pbxjW7D52gRExBzz/HNYbfqEjEBMbeNL7WSwsJcISZi1jO+uZPUjMwVYiJmPeObgq5xPyViAmKePb48NJKaId/1XKU4IybsHWxjsWLv18Y3tZLky6+WsR1z+blKMcY4ffIMmQu8ooaYiPmBPryJas3XGN/UOUnq9uiQREl+SIXnal5fz2oRE149rj95VJcSM+jKYuZxtdLvlMPGVSHfL2XFjGaL+zg9iPnAZKlp39UydynmPHaNJKmJu92wHp/fPm76uayYNqozs9Q/jX7uRsR87Lx1XQW6YdlHzNSHMa9ijqGINO/GN48xNKcfIwx7di3j65sBXDeVFDOpXfuu6rLZ3EhyiPnANK9iLfRTKi1mJ3m5ySzKyRe5aVn6v//vf//pT3/6X//uf/7ty+h//uXPf4k/JJyN/+EtHb+8+2fXjsXE7DTZoDalVqNZq5hTi5gPTHgfbCGWFDMpJJudN4tqk80KxRb56/Pz+7nqpiJiNiFIjZmXmWW1lhWoMR+b+b+9j74ulRRz0GRmrfKpxgzaRczf/Jef//mPX66DfTyb+Uf8n51S2SaEfrKTjuaVJ0XEfGAp+/B+FXAxl01lW2UzGzSexOxVrmk+z/MYY3he85tu2PfLevGdlSVrzFOZuYo5Iuajksd2DbHfv9LydLC0pJidFjOLmk5irqIWDrY8D51/2i6ddhfz2crCYpp3pLJYKanpxzS9bP3M5YLNpmzWNGaTBjML7qld4rztFWxzDB+8KS/mu/96UTGHdctnNPNutLlBzMfKYNcufDsmezl3oi6VDLZJzRTVm5lcXDp1ZlF+nIN62zPY5r5Znzi75LTxo/NFxUxBTmqT2djIKSDmIy2WXpLC86HPtJaWqWyw2ewlv5xeVXZdMotqTzXsvsGWBi9J7Q7LZv5G4H8x4FfnO1L39EgZ29k4xP4wWkb34WyM1Lw7ml2mxhyXZ1OymVman/60e7AtndPHH2sXeO0LCmn5fin5uLQcINjWxKDI+oyYcAUtu/QowTa311ATMeF7DE7SeUdVjxJsqdv/EgPEhG8VfM2Zq+Whgm1V08+IiZhVkoKkkB4u2MxsCaf3NRATMWvMYsP8gMFmZmZTs2c+i5jwjeXSDQ8ZbCeipJAREzGrWy6TPbKY67NpQkzErIZ88XJ5zO9jDnt9KQExYQPz5cvlQb8ovTwdEURMxLw5cdvnzY8opuV+lz0gxISLQ7Hd+HnzQ4ppNrkdGieqHsSsjOS3fq/1oGJa2iGdRUy4sKhy2vru41HFNOv3++b7vYOY12HU9psijyumjW5T1Y2YUMxLtxhifkwkGqkjPhDzNnTfKqaOLKZlL/lMiCDmjbzM3wn8g2xo/HB2moUgQcxbeNl+Z004uJg2XuNT04gJH72kivqS2anABXSICZfUUHj562zv8SImbCPg5TmPr1byiXlATPLYyuCsAWLiZY2MrsjHOhET8LIoi2O2EPMqDFo/5AbnFZp+vytHEBNekjPOtFyeYXDWADH3Ts3wckuO4SamATH3LZkcXl7KxFkDxNy7YHJkZRueZ37XC6ER89HxEjnZpidaoARAzN3oaMptpv/Gy6tcLQK/solBS24z37juATHhC2YpMAvfKDQ3X5DE9ZXwRZnEhuw3SX7LzdiICV/iJTZkv/ls67Z1NBETfggbP0UKzU33QSMmfLF1wcZPiULTb1g0ERN+FE+SZxaKEPW4nyxEzNLFkWfjp+yiGTNiwrfpOfFTksFJzYiY8E2mzV8ogc8zkE6XqImY8GkYOc55Fs9ngyQ/IiZsJ9DB3IE5SGqGjJiwsSLi21U7qum69w+9PiEmnJF0cUR2PzU7SfLj62UzS2G6npgpzoh5lwUmnZI9SbGR5NoXN2dJat60UwqImWKMcfrkFzkXuFsBMW8AnZK9mVpJUhiWFzElvUpxC4h5+q+2iHmcRJZOye7L5hAkSa6Ns43PLzk+b9oWETOaLU4zYh4DEtkrVQxj51Ydf371/rGLqaSYNqozs9TH9FTjjoh5lwwkslfMToa2eSumpHYuKGZSa6mV1ldc5kaSQ8x7zLEcO7JXnvHp399f29GMxcTsNNmgNqVWo1mrmFOLmHdIK8dn5K5MeKulC3EuImYTgtSYeZlZVmtZgRrzPpm4p/imYjbdulNbSsx+spOO5pUnRcS8zw2Jhpcwr89pD8j3Y7o48H8tlT2VmauYI2LeKb3EV1evjqQQ57wp8M8Q07wjlb1vaGHehGHZHvjniDmsWz6jmXejzQ1i3hu0MOtZRAuKmYKc1CazsZFTQMx7e3LTwjyQmK/Pqqfu6QWWsZ2NQ+z3BS3MQ4lZx/gQ8/vQwkRMxKwPWpiIiZj1QQsTMRGzQmhhIiZi1gctTMREzAqhhYmYiFkftDAREzHrgxYmYiJmhdDCREzErA9amIiJmPVBCxMxEbNCaGFWGPi1g5i7QwsTMRGzQmhhwn5PGKZgK7QwATHrgxYmIGaF0MIExKwPWpiAmPVBCxMQs0JoYQJi1gctTEDMCqGFCYhZH7QwATHrgxYmIGaF0MIExKwPWpiAmPVBCxMQs0JoYQJi1gctTEDMCqGFCYhZH7QwATHrgxYmIGaF0MIExKwPWpi1xzOXcT0itDAREzErhBZm/WIeZHyIeQG0MBETMSuEFiZiImZ90MJETMSsD1qYiImYFUILEzERsz5oYSImYtYHLUzERMwKoYWJmIhZH7QwERMxK4QWJmIiZn1EWpiIiZg1JrIts/DoYs4FtuURk0QWMbf6J7k2LohJIgubSDuJGWL72aMYMUlk4azgde0w7yBmNDOvETFJZGFblEtSiHMuL2ZSMEvRNTGZmc2tQkRMElk4g/B8LYDvx1RWzEm9zVIXpMUsrn+qUMzDXNlweSHjSGSrF1OSmm5YSomZRq9kvZbVUPMumY2IWZOYgUS2UvK/fQiCttCurNREs6YxM3Pektpaa8zDNG4vhbejq2QZuka/f2ul61OpXdlhMbNlTZWC8qABMesSk0S2wpVy7Jwk6bdvMtkxl6wxT2ulmTWNzeoRsy4xSWQrIw1+XR5DnP/zRctuLhYHL/51ymZJ3UnRETGrEZNEti7Gdb8nDMtLNSi5mArGwYuYo1yMTpNZKz/Vuiv7iGIu4pqfiurKzkly3ZifFZKkMJaNg1cZ6xikMJlZjk4NK2YtYmaOFlS0WPoPFibJdcuucbA8rcV5uW6cIuYX9CSy1WjZSGr6d6djmyEfNU4R88dM3FpQk5ZheqQ4RcwfJ7JOnkS2AmYvKcyPFaeI+UPWU5JwY1I4X0vEfAAxB2lAi1uTe0nNfMM4QMy6xKRTUkUW20huvPFeA2JWJCadkhqWy1ZSnw0xEfOJjk5JFculn28bB4hZl5gDnZKbE7XhDBxiHlrMmQLz1iR/0aYPYj6CmMmpocC8KZOT2myIiZiv8HQwb0x/4WYsYj6CmJ004saN01i/bIyDg1yBg5gfGKUOOW7I7KQuG2Ii5pvqRnyh9qaMW9PYQ4GY71jY+Ll9eUmFj5jvyI6wuCW5E+/0IObHuPB80f2mXvptXRLEPLiYbMjelMVx4goxP/eSuLgdk+O5iJife0mj5HYMkqOOQMzPAoMTsrej23yqADEPLebIfuANyYHpR0y8rI3FU0YgJl5W56XjhiXExMva4BQeYuJlfXAKDzF/GBkVe3nwr3lzCg8xf0DlkXFsMTmFh5g/iIxWCvmoD53ax8cpPMT88RO7O27gVz4+TuEh5t0+sQ8sJqfwEPNzxjt4Yh9WzFz+FB5XixwjOOI9PLGPKubiy2+6IeYRgiOHuzg3fVAxB+1QRHB95QGCY3b3sVF/zIdiK7mJuULMz9LY+zifedSH4h49KsS89+BYvNTcxzmw44mZ+y0fDELMBwiOqO2XCiPmN8c3N7vV9oh518Gx+F0KHMQ8e7nsM3OFmO8jo9NdHc88lpij2/R9PcQ8enDkuGtkEGxf5ypBUszMFWJ+8sB28a7eZjiOmKmTFBbmCjHfa9lI6pIZYl5/fKnX7jcVIOY9/sBjIyncmZZHCbbU6Qq5CmLe3Q+cYiMp3OG7DEcItrnVVUoIxNyJNOddfuCp051qeYBgy0Ozi5ZLuupczQXORNQhZp7PqPOXN7LEjR/b+nJ8S99Ict09HPSZhnSdYIvFPmv29fjy2EpSM+YdfgQ/LMXnapbk2rgcVswczlqjgvYVc7VSfriPndgo+XdulhKzzExfFBt5zVTUzTvNldT0S2kxQ2y9XD6omMnJxeiUbihmGlsnSa6/m9sRo9bHSLp/MecY1h9mzHvOldR0U1Exo5n5j+/PH0TMbj129dqI9BJtS34XLnl5DpclF/iB8xxXKeW6uzl89yrYXq0EpcV8NdM7iZnnoV+l/LD87zJXkutW+4uJmRTMUnRNTLZuXoV4DDGl/Dx/izTY3EphMrMQ5iDXvQ6X1Lm1ComKQa5P23/gNE+xD83pFxaGO7tJ+FWwPblZVMwUnfxoTzNdYkPm1fjmeYxdeB5/d8FaucznMsUTf357N0A75nJiTuptlrogLWZx/dMRxJzlX2LNhZjmNbMdzYIUhuYpxw0yM6kbG3VmUQpjuPxzeDooTTeVFdMpjI36daaHpsQFgdJf//TTTz/91etx/+bvf/Z/DM/Px334w4e/CYXETKNXsl7Laqh5l8zGg4jZv4gZzNafMqszC5rNhqccPshs0mhmvjGLGj9UQ48spqS2pJjLWkA9z3TTlBDzyoQT//r2r12Zh9i8PhHj0+Q4b0ntYWrM+eVZvG4zNM7MzLuTds8/ZZBZp+Wk7vrv9hdvTEj/45dffvn5n//lX/7u5RfVDvfXt4y7pGfPM92f5vdpplulAsH2T977f/yH3/3ub14G/rc///Lnv8Th7Px0Tt+bq3Jp/6wQh8XMFrXrtOVBw2HEXNS8FXNNT1vNn4jpZWY2aDj9u/HiKyVfjy/NY2z9U2TfWZEZ31lZuMYM72a6L7A3+2Z88zzG5wzW9/NV5qroRtmLf87bmlSs6d9BdmVfGiVrCHhnp3XzrZiNO6W51n3jOf7J+ObhtC3b9Mv9iemKtgCexVznt1N681spH2zz0DWntGXM+87Vm19vUTE7ZbOk7qToMWpMiwqz2dy+pKeT2bLWmKcff26XteqcFM1y05hFTWbp8srnB+N7amQ2Q7onMd92eAoE29JOZvKnX0Bu/CkrOWVr+wRbntazHWqn3ebq/UO3qJjjul85mbXy00F2ZS17KQS58STmInWdNL0Sc3TqnMZ1r7B3T3uF/YYZ+GJ8U+f2jI7iwda8z/9KiOkVnAYz82p6p7jOdFfkGvqvxpeGsG6l7PFgHD+mQkXFtDGcOnw5OjXjUY7k9Y2aIT+fMUnRuS7Z61Q296djIXlo1mNbUVPYctb86/Gtbjb38H70J8eLi6SyozsdwBmDusXMxjCHMq+m/sr48uglqb3KRlzpc8XP5+Tzct3x7ft2Sf6Vf379N/mLf+v741ujY8PJhQq4/1eZls5J67kG5qoGMav6gZdOd3Rn5cGCLY+NpGZkrhDzk4In3t+FP8cJtilcQU3EvM8fOEe3+7UzBNsP6+ew+8vqiHmvP3DqJPkZMW8yvjnsXE0g5v0GRwo73gROsP1aQttIbmCuEPOz53ZzT19IONhN7Dm6He+WRcw7D457+kjC0T4qlMJ+iyZi3nlwLP5+vpNwvM/wjbt9Mhgx7z444h5fGkfMM1OWILmZuULMzxbNZp+PGhNs5z4XI3OFmJ89trudHtsE282ei4h5iOAYVOT1CsTcQm53eC7Wf1MMYp712HYqcR0VYm5iKJ/OIuZBgiN7yWfEvM34luYu3yq4yqQ+fHB0UrMg5m3Gl0P9z0XEvFFwjJJbEPNG4+trn33EvFlwjK7u2DhM3fSj56JGRETMH2wBjYh5GzFtcfdy0gMxr53uVW7mwUn+Tk56IObV6zDMvCW5kzyFJmJiZm3Eu3oPDzGvJ6YtHjNvyOSkgWlAzE/yKcy8JUtzB2ewEPMGYlpydNRuWWhy1gAxf1hnYuYN6ThrgJiYWSHj/V0tiphXGd/i1JBN3Y6ZswaI+SkTdc5NSf6OLklDzCuOb1SJL0bCVnIr+cQ8IOZ7enbtb0u8j/teEPPa4+vodN+WkUNYiPkZXuJ02C35zn0vXC1yXDGzp2ly40Jz+30viHlcMW1xbM3emM33vXB95YHFtImt2Vuz9QI9xDyymBZ3uSUcLmB2m96eRsxDi2lBYsv+xoVmu+WAHmIeW8zcyNHmvnU666SQEBMxX7E4edS4MUuQXMyIiZgvjBynrmTRbCbERMwXOsrMGirNTlKYERMxX5eZdDNvzxwuURMxDy+mLVLAiwoYG0lhQkzEPBU4HGevSc1mzIiJmLZ2Mzk0W4maXpLr3v06XJ8Q8wHFzByarajWbCXJv142F0ntdLU4nQscB0PMIky8NV0RKTaSFIb0bIokNUMuGgezJNfGBTHrFdN63s2siqldXeyn/CzmmxS3iJghtv6TLXnErEdM8/RM6iKPrVvl7Ib/eHnLMYwFxYxm5j/eooCYFYm5kMxWWG72XpL029cvILuYSoqZFMxSdE1Mpwo3RMSsR0yLHACqcuGcY3B/eHc5QDeXE3NSb7PUrTvzcf1TlWIe+qvGXyaz3AFdKeFDEIRCYqbRK1mvZTXUvEtmI2LWJObCafb7EDP0Uy61Kys10axpzMyct6S21hrzgelJZmsX04U4F9z8CXFYzGxZL5gJyoMGxKyvnGlIZmvdWFh3Z5eiew0v/jlvZtY0NqtHzPqYSWYrFdP3U9oY+OeI2SmbJXUnRUfEJJmFnQP/HDFHuRidJrNWfqpzV5Zklml4ODFtDKf3zXJ0algxSWbhdmK+YXlKlfNy3fEhJsksYlY4PsQkmUVMxLznZJa72RETMWtMZrnNADERs7pk1nE1F2IiZn1MXM2FmIhZIYF3phETMesjOb6aiZiIWR+8M42YiFkjvDONmIhZITQzERMxa4RmJmIiZoXQzKxfzINcgYOYF0EzEzERs0ZoZsJ1njBMwUXQzATErJHI10wAMSuEZiYgZoVwzQggZo3QzATErJDs5JkFQMzaoJkJiFkjQS4xC4CYlUEzExCzRmhmAmLWCM1MQMwKoZkJiFkjNDMBMSuEZiYgZo3QzATErJGWZiYgZn3QzATErJGBZmaF8czVIkAzEzERs0IWmpkVinmQ8SHmN6CZiZiIWSG5oZmJmIhZHzQzERMxa4RmJmIiZoXQzERMxKwRmpmIiZg1QjMTMRGzQmhmIiZi1kjPB+AREzHrg2YmYiJmjUx8AB4xEbNCaGY+hphzgQcwYl6RxAfgjyTmLMm1cUHMu4dm5o2eiDuJGWLrP/lyOGLeHZ4PwN9keXTtMO8gZjQzrxEx7x6amTfKWyUpxDmXFzMpmKXompjMzOZWISLm3UEz8xaE52sBfD+msmJO6m2WuiAtZnH9E2LeGzQzbyumJDXdsJQSM41eyXotq6HmXTIbEfP+oJl5g6fhv324UKcttCsrNdGsaczMnLeklhrzTqGZed2qfuga/f6tla5PpXZlh8XMlvWVvqA8aEDMO4Vm5vVWyrFzkqTfvslkx1yyxjytlWbWNDarR8x7hWbmdR6Ag1+XxxDn/3zRspsvDPxzxOyUzZK6k6LUmPe6FUEzc2/Gdb8nDMtLNSi5mC4O/HPEHOVidJrMWvmJXdl7LXvENSP7TnDnJLluzM8KSVIYtwT+OWLaGKQwmVmOTg0r5p0SuTNvz8XSf7AwSa5btgX+uQ+Dp7U4l7lBGDFvk8xyAfReWjaSmv7dxncz5K2BfyMQ8xZkJ0+ZuZeWYSoZ+Ij5SEycmd2B2UsKc9nAR8yHoqdnUpoUztcSMeEHyaznAFDZCe0lNXP5wEfMx2LhAFDRLLaR3LhH4CPmgzFwmr3cctlK6rMhJnyfljKz4HLp550CHzEfscykm1mAqA3JB2LCF2Um3cxvk/xFmz6ICb/KxKHZ78+hk9psiAkF6dkA+v4MXrQZi5hwDoG7ub6bxvplY+DXDmLekNywAbSd2UndxiodMeErFsf3bLcybk1jDwVi7rR5IbZmt5eXZBuIueNzn63ZDUVAxxMNMfd+8nfMwqVe+m1dEsSEs+kkSqWLS3NeaEXMvfGYeWFh7pgxxLxOXkacnc8gOdq/iHkdM3nT5ILU37Mdi5hXqpnY+j/zIRbYjkVMzKxuojyb2IiJmRVOE5dlIyZmVgan8BDzJmYSdF/CKTzEvFGa9i0zD/PGxOdwCg8x79PMY4vJKTzEvBXJf+tKg8O8lf+jpxan8BDzNuRvNQOOLCan8BDz1mZurqMOLCan8BDzxnTbdx4PK2YufwqPq0XgQkZtTdqOKubiy2/HIiZs2ebYdMfUQcUctMO2D9dXwrZCc0HMdTJayU2GmIhZAb3kBsQ8XVEZsiEmYtZRaG65+f94YuZeO11Wj5iwiRQuP699ODHnZrd3ohETNjJICumBxcz9xZ+jRUy40qIZ86OKObpN39dDTNh/0XRSMz6kmEuQFLMhJmJWSO4khfnhxEydpLBU8pBATPjAHM5X8yjBlnrtflMBYsI3mZpz1TxGsKVOF9bWiAk3YWwk+fFdqMZ0xGCb22toiZhQTk3XLW9/dd1ysGDLQ7OLlku6qphzgTMRiHkvtWYrSc3wHGJZksK0f7DFYl+j/3p8eVx/xDHv8CP4ofxDbJbk2rgg5mOTYiNJ/uTmvL4c9DqOS4kZdHUx89RJkrp5n2eLpKZfSosZYuvlMmI+/LLZOUlquik9iSm552LzXsWcY5A+K6OLirlOXFExo5n5jy/PIuYDMq1uqvnDq3dqT8VmaTGXZzGXncTM89CvUj5nAnuKKcl1q/3FxEwKZim6Zn0+zq1CRMzHXDejl/Rf37zuHqbSYqbo5Eczi4qhzIbMq/HN8xi7oOeV7IK1cpnPZYon/vz2boB2zOXEnNTbLHVBWszi+ifEfFw5//u7myiaMRcV0ymMjXqzKIWhKfElH+mvf/rpp5/+6vWwf/P3P/s/htDsekvHHz78TSgkZhq9kvVaVkPNu2Q2IuYDE97HmutKirmsBVRjFjWaWdOUEPPKhBP/+n6mplK7slITnybHeUtqqTEfHP8mAvsplU1le81m1ms5bf60SgWC7Z+89//4D7/73d+8DP1vf/7lz3+Jw9n56bxhHPF1ZrFuzhbalR0WM1vUrtOWBw2I+eC81GfDfOkv8wwx1w2gQcNJzL7A3uyb8c3zGJ8zWN/vemlsfGdlyc2f01q5JhWzesRETBfilLf8Ms8Qc9WxUzr9yTvbJdjmoVvtdO2Y9xXzTSOzqJidsllSd1KUGvOBWbpx2fzL/OI/205m8maLOrPc+FONecrW9gm2PPWrnO20m5hvjxcUFnOUi9FpMmvlJ3ZlobyYXsFpMDOvpneK665sV+TDIV+NLw1h3UrZo5s59ns8xF5lrGM4daxydGpYMaF0sJmN7nQAZwzrwYUxzEFd2n98efSS1M53M1evn2hPE5SX644PMR9EzJuOb+mctJ5rYK4QEzHrGV8eG1100RFiAmJeZXxTuIKaiAmIeen4LrnoCDEBMa82vjlo4yfPEBMQc8fxTc2mDyshJiDmruPL0e14tyxiAmJuHF8K+y2aiAmIuXl8m75GiJiAmDuPLwfJzcwVYiJmZeOL+3y6FjEBMb81vqXZ42PviAmI+b3x5XaHdFbVg5iIWfv4hvLpLGICYn57fEuz7zmge/6lMwWIebvx5SB5zERMxKxtfL3kFn7HiHmXYh6kbvqUUUXuN0FMQMySYtripJ7fMmJCZSS/R0cTMQG+R+4kT6GJmFAbUXIT04CYUBmTkwamATGhMpZGJT4JiJgAZQtNzhogJtRIx1kDxIQKGSXHWQPEhNqYOWuAmFAhye91GRBiAmwnt5JPzANiQmXEna7pQkyA7zA6XjdBTKiPxW0/a8DVIgC7FZp+81kDxATYj05qlm1iVp6hIibcM1sv0ENMgD2Z3aa3pxETYN9Cs91yQA8xAfZOZ50UEmIC1MUSJBczYgLUt2g2E2ICVFZpdpLCjJgAdTGHS9RETIArMTaSwoSYABWq2YwZMQHqUtNLct27Y3quT4gJcNNas5Uk/3rZXCS109XEnAt8ZRcx4XCk2EhSGNKzKZLUDLmomLMk18YFMQHOZGpXF/spP4v5JsUtImaIrZfLiAlwLnls3SpnN/zHy1uOYSwoZjQz//EWBcQE+FKd3kuSfvv6BWQXU0kxk4JZiq6J6VThhoiYAL+ycM4xuD+8uxygm8uJOam3WeqCtJjF9U+ICfDrhA/3doRCYqbRK1mvZTXUvEtmI2ICXCxm6KdcaldWaqJZ05iZOW9JLTUmwKViuhDnCwP/KzFDHBYzW9Su/y950ICYAGdH+bo7u2wI/F+rMU9rpZk1jc3qERPg3OD1/ZQ2Bv45YnbKZkndSVFqTIC9A/8cMUe5GJ0ms1Z+YlcWoAoxbQyn981ydGpYMQFuJ+YblqdUOS/XHR9iAmJWOD7EBMRETADERExATMQEQEzEBEBMAMRETADEBEBMxARATMQExERMAMRETIAPgV87iAmIiZgAUPIJwxQAICYAICYAYgIAYgIgJgAgJgBiAgBiAgBiAiAmACAmAGICAGICICYAICYAICYAYgIAYgIgJgAgJgBiAgBiAgBiAiAmACAmAGICAGICICYAICYAICYAYgIAYgIgJgAgJgBiAgBiAgBiAtwJ/x8tnwv2JzBxuQAAAABJRU5ErkJggg==" width="920" height="602" class="img_ev3q"></p><p>每一个 Job 对象都会持有一个或者多个 Pod，而每一个 CronJob 就会持有多个 Job 对象，CronJob 能够按照时间对任务进行调度，它与 <a href="https://en.wikipedia.org/wiki/Cron" target="_blank" rel="noopener noreferrer">crontab</a> 非常相似，我们可以使用 Cron 格式快速指定任务的调度时间：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> batch/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CronJob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">schedule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*/1 * * * *&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">jobTemplate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">completions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">parallelism</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> perl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;perl&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;-Mbignum=bpi&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-wle&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;print bpi(2000)&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">restartPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OnFailure</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上述的 CronJob 对象被创建之后，每分钟都会创建一个新的 Job 对象，所有的 CronJob 创建的任务都会带有调度时的时间戳，例如：pi-1551660600 和 pi-1551660660 两个任务：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ k get cronjob --watch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME   SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi    */1 * * * *    False     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">        </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">          3s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi    */1 * * * *    False     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">        1s              7s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ k get job --watch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME            COMPLETIONS   DURATION   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi-1551660600   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/3   0s    0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi-1551660600   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/3   16s   16s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi-1551660600   </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/3   31s   31s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi-1551660600   </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/3   44s   44s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi-1551660660   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/3         1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi-1551660660   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/3   1s    1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi-1551660660   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/3   14s   14s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi-1551660660   </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/3   28s   28s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi-1551660660   </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/3   42s   43s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>CronJob 中保存的任务其实是有上限的，<code>spec.successfulJobsHistoryLimit</code> 和 <code>spec.failedJobsHistoryLimit</code>分别记录了能够保存的成功或者失败的任务上限，超过这个上限的任务都会被删除，默认情况下这两个属性分别为 <code>spec.successfulJobsHistoryLimit=3</code> 和 <code>spec.failedJobsHistoryLimit=1</code>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二任务">二、任务<a class="hash-link" href="#二任务" title="Direct link to heading">​</a></h2><p>Job 遵循 Kubernetes 的控制器模式进行设计，在发生需要监听的事件时，Informer 就会调用控制器中的回调将需要处理的资源 Job 加入队列，而控制器持有的工作协程就会处理这些任务。</p><p><img loading="lazy" alt="k8s-33" src="data:image/png;base64,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" width="1240" height="340" class="img_ev3q"></p><p>用于处理 Job 资源的 <code>JobController</code> 控制器会监听 Pod 和 Job 这两个资源的变更事件，而资源的同步还是需要运行 <code>syncJob</code> 方法。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1同步">1、同步<a class="hash-link" href="#1同步" title="Direct link to heading">​</a></h3><p><code>syncJob</code> 是 <code>JobController</code> 中主要用于同步 Job 资源的方法，这个方法的主要作用就是对资源进行同步，它的大体架构就是先获取一些当前同步的基本信息，然后调用 <code>manageJob</code> 方法管理 Job 对应的 Pod 对象，最后计算出处于 <code>active</code>、<code>failed</code> 和 <code>succeed</code> 三种状态的 Pod 数量并更新 Job 的状态：</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jm </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">JobController</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">syncJob</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">bool</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ns</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SplitMetaNamespaceKey</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sharedJob</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> jm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">jobLister</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Jobs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ns</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    job </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sharedJob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jobNeedsSync </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> jm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">expectations</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SatisfiedExpectations</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pods</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> jm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPodsForJob</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    activePods </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> controller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FilterActivePods</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pods</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">int32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">activePods</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    succeeded</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> failed </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pods</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conditions </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Conditions</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这一部分代码会从 apiserver 中该名字对应的 Job 对象，然后获取 Job 对应的 Pod 数组并根据计算不同状态 Pod 的数量，为之后状态的更新和比对做准备。</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> manageJobErr </span><span class="token builtin">error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> jobNeedsSync </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DeletionTimestamp </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        active</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> manageJobErr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">manageJob</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">activePods</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> succeeded</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>准备工作完成之后，会调用 <code>manageJob</code> 方法，该方法主要负责管理 Job 持有的一系列 Pod 的运行，它最终会返回目前集群中当前 Job 对应的活跃任务的数量。</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    completions </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> succeeded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    complete </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Completions </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> succeeded </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> active </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            complete </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> completions </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Completions </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            complete </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> complete </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Conditions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Conditions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">newCondition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">batch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">JobComplete</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        now </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> metav1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CompletionTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">now</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Active </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> active </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Succeeded </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> succeeded </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Failed </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> failed </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Conditions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> conditions </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Active </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> active</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Succeeded </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> succeeded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Failed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">updateHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> forget</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> manageJobErr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最后的这段代码会将 Job 规格中设置的 <code>spec.completions</code> 和已经完成的任务数量进行比对，确认当前的 Job 是否已经结束运行，如果任务已经结束运行就会更新当前 Job 的完成时间，同时当 <code>JobController</code> 发现有一些状态没有正确同步时，也会调用 <code>updateHandler</code> 更新资源的状态。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2并行执行">2、并行执行<a class="hash-link" href="#2并行执行" title="Direct link to heading">​</a></h3><p>Pod 的创建和删除都是由 <code>manageJob</code> 这个方法负责的，这个方法根据 Job 的 <code>spec.parallelism</code> 配置对目前集群中的节点进行创建和删除。</p><p><img loading="lazy" alt="k8s-34" src="/assets/images/k8s-34-d91fa92f976634d21b55ad37d2f93b6a.png" width="820" height="680" class="img_ev3q"></p><p>如果当前正在执行的活跃节点数量超过了 <code>spec.parallelism</code>，那么就会按照创建的升删除多余的任务，删除任务时会使用 <code>DeletePod</code> 方法：</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jm </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">JobController</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">manageJob</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">activePods </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">v1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Pod</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> succeeded </span><span class="token builtin">int32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> job </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">batch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Job</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">int32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">int32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">activePods</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parallelism </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Parallelism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> active </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> parallelism </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        diff </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> active </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> parallelism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sort</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">controller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ActivePods</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">activePods</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        active </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> diff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        wait </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> sync</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">WaitGroup</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        wait</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">int32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> diff</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">go</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ix </span><span class="token builtin">int32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> wait</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Done</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                jm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">podControl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">DeletePod</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Namespace</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> activePods</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ix</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> job</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        wait</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当正在活跃的节点数量小于 <code>spec.parallelism</code> 时，我们就会根据当前未完成的任务数和并行度计算出最大可以处于活跃的 Pod 个数 <code>wantActive</code> 以及与当前的活跃 Pod 数相差的 <code>diff</code>：</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> active </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> parallelism </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        wantActive </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">int32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Completions </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> succeeded </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                wantActive </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> active</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                wantActive </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parallelism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            wantActive </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Completions </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> succeeded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> wantActive </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> parallelism </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                wantActive </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parallelism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        diff </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> wantActive </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> active</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> diff </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            diff </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        active </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> diff</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在方法的最后就会以批量的方式并行创建 Pod，所有 Pod 的创建都是通过 <code>CreatePodsWithControllerRef</code> 方法在 Goroutine 中执行的。</p><p><img loading="lazy" alt="k8s-35" src="data:image/png;base64,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" width="820" height="680" class="img_ev3q"></p><p>这里会使用 <code>WaitGroup</code> 等待每个 Batch 中创建的结果返回才会执行下一个 Batch，Batch 的大小是从 1 开始指数增加的，以冷启动的方式避免首次创建的任务过多造成失败：</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        wait </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> sync</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">WaitGroup</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> batchSize </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">int32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IntMin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diff</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> controller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SlowStartInitialBatchSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> diff </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> batchSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> integer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Int32Min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">batchSize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> diff</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            wait</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">batchSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">int32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> batchSize</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">go</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> wait</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Done</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    jm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">podControl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">CreatePodsWithControllerRef</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Namespace</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Template</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> job</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> metav1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewControllerRef</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> controllerKind</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            wait</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            diff </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> batchSize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> active</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过对 <code>manageJob</code> 的分析，我们其实能够看出这个方法就是根据规格中的配置对 Pod 进行管理，它在较多并行时删除 Pod，较少并行时创建 Pod，也算是一个简单的资源利用和调度机制，代码非常直白并且容易理解，不需要花太大的篇幅。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三定时任务">三、定时任务<a class="hash-link" href="#三定时任务" title="Direct link to heading">​</a></h2><p>用于管理 CronJob 资源的 <code>CronJobController</code> 虽然也使用了控制器模式，但是它的实现与其他的控制器不太一样，他没有从 Informer 中接受其他消息变动的通知，而是直接访问 apiserver 中的数据：</p><p><img loading="lazy" alt="k8s-36" src="data:image/png;base64,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" width="880" height="391" class="img_ev3q"></p><p>从 apiserver 中获取了 Job 和 CronJob 的信息之后就会调用 <code>JobControl</code> 向 apiserver 发起请求创建新的 Job 资源，这一个过程都是由 <code>CronJobController</code>的 <code>syncAll</code> 方法驱动的，我们接下来就来介绍这一方法的实现。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1同步-1">1、同步<a class="hash-link" href="#1同步-1" title="Direct link to heading">​</a></h3><p><code>syncAll</code> 方法会从 apiserver 中取出所有的 Job 和 CronJob 对象，然后通过 <code>groupJobsByParent</code> 将任务按照 <code>spec.ownerReferences</code> 进行分类并遍历去同步所有的 CronJob：</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jm </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">CronJobController</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">syncAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> jm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kubeClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">BatchV1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Jobs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">metav1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">NamespaceAll</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">List</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">metav1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ListOptions</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    js </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> jl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Items</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sjl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> jm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kubeClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">BatchV1beta1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">CronJobs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">metav1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">NamespaceAll</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">List</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">metav1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ListOptions</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sjs </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> sjl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Items</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jobsBySj </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">groupJobsByParent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">js</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sj </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">range</span><span class="token plain"> sjs </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">syncOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jobsBySj</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UID</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">jobControl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sjControl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">recorder</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">cleanupFinishedJobs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jobsBySj</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UID</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">jobControl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sjControl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">recorder</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>syncOne</code> 就是用于同步单个 CronJob 对象的方法，这个方法会首先遍历全部的 Job 对象，只保留正在运行的活跃对象并更新 CronJob 的状态：</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">syncOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sj </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">batchv1beta1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CronJob</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> js </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">batchv1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Job</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> now time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jc jobControlInterface</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sjc sjControlInterface</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> recorder record</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EventRecorder</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    childrenJobs </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UID</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">bool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">range</span><span class="token plain"> js </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        childrenJobs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ObjectMeta</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UID</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        found </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">inActiveList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ObjectMeta</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> found </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">IsJobFinished</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">deleteFromActiveList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ObjectMeta</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">range</span><span class="token plain"> sj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Active </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> found </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> childrenJobs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UID</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">found </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">deleteFromActiveList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    updatedSJ</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> sjc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">UpdateStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">updatedSJ</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>随后的 <code>getRecentUnmetScheduleTimes</code> 方法会根据 CronJob 的调度配置 <code>spec.schedule</code> 和上一次执行任务的时间计算出我们缺失的任务次数。</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    times</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getRecentUnmetScheduleTimes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> now</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">times</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scheduledTime </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> times</span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">times</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> sj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ConcurrencyPolicy </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> batchv1beta1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ForbidConcurrent </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Active</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> sj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ConcurrencyPolicy </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> batchv1beta1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ReplaceConcurrent </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">range</span><span class="token plain"> sj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Active </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            job</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> jc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetJob</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Namespace</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token function" style="color:#d73a49">deleteJob</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> job</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> recorder</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果现在需要调度新的任务，但是当前已经存在活跃的任务，就会根据并发策略的配置执行不同的操作：</p><ol><li>使用 <code>ForbidConcurrent</code> 策略跳过这一次任务的调度直接返回；</li><li>使用 <code>ReplaceConcurrent</code> 策略获取并删除全部活跃的任务，通过创建新的 Pod 替换这些正在执行的活跃 Pod；</li></ol><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    jobReq</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getJobFromTemplate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> scheduledTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jobResp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> jc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">CreateJob</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Namespace</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jobReq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ref</span><span class="token punctuation" style="color:#393A34">,</span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getRef</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jobResp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Active </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Active</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LastScheduleTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">metav1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Time</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">Time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> scheduledTime</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sjc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">UpdateStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在方法的最后，它会从 CronJob 的 <code>spec.jobTemplate</code> 中拿到创建 Job 使用的模板并调用 <code>JobControl</code> 的 <code>CreateJob</code> 向 apiserver 发起创建任务的 HTTP 请求，接下来的操作就都是由 <code>JobController</code> 负责了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a class="hash-link" href="#总结" title="Direct link to heading">​</a></h2><p>Job 作为 Kubernetes 中用于处理任务的资源，与其他的资源没有太多的区别，它也使用 Kubernetes 中常见的控制器模式，监听 Informer 中的事件并运行 <code>syncHandler</code> 同步任务</p><p>而 CronJob 由于其功能的特殊性，每隔 10s 会从 apiserver 中取出资源并进行检查是否应该触发调度创建新的资源，需要注意的是 CronJob 并不能保证在准确的目标时间执行，执行会有一定程度的滞后。</p><p>两个控制器的实现都比较清晰，只是边界条件比较多，分析其实现原理时一定要多注意。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="referenece">Referenece<a class="hash-link" href="#referenece" title="Direct link to heading">​</a></h2><ul><li><a href="https://kubernetes.io/docs/concepts/workloads/controllers/jobs-run-to-completion/" target="_blank" rel="noopener noreferrer">Jobs - Run to Completion · Kubernetes</a></li><li><a href="https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/" target="_blank" rel="noopener noreferrer">CronJob · Kubernetes</a></li><li><a href="https://kubernetes.io/docs/tasks/job/parallel-processing-expansion/" target="_blank" rel="noopener noreferrer">Parallel Processing using Expansions</a></li><li>[Coarse Parallel Processing Using a Work Queue]<!-- -->(Coarse Parallel Processing Using a Work Queue)</li><li><a href="https://kubernetes.io/docs/tasks/job/fine-parallel-processing-work-queue/" target="_blank" rel="noopener noreferrer">Fine Parallel Processing Using a Work Queue</a></li><li><a href="https://kubernetes.io/docs/tasks/job/automated-tasks-with-cron-jobs/" target="_blank" rel="noopener noreferrer">Running Automated Tasks with a CronJob</a></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Knowledge/容器技术/kubernetes对象详解/daemonSet"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">详解 Kubernetes DaemonSet 的实现原理</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Knowledge/数据存储/设计数据密集型应用/序"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">序</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一概述" class="table-of-contents__link toc-highlight">一、概述</a></li><li><a href="#二任务" class="table-of-contents__link toc-highlight">二、任务</a><ul><li><a href="#1同步" class="table-of-contents__link toc-highlight">1、同步</a></li><li><a href="#2并行执行" class="table-of-contents__link toc-highlight">2、并行执行</a></li></ul></li><li><a href="#三定时任务" class="table-of-contents__link toc-highlight">三、定时任务</a><ul><li><a href="#1同步-1" class="table-of-contents__link toc-highlight">1、同步</a></li></ul></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li><li><a href="#referenece" class="table-of-contents__link toc-highlight">Referenece</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Doongz Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.958a4673.js"></script>
<script src="/assets/js/main.715bfe53.js"></script>
</body>
</html>