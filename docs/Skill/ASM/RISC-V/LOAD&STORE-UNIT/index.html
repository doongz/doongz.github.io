<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Skill/ASM/RISC-V/LOAD&STORE-UNIT">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">LSU &amp; SRAM &amp; GPIO模块 | Doongz&#x27;s Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doongz.github.io/docs/Skill/ASM/RISC-V/LOAD&amp;STORE-UNIT"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="LSU &amp; SRAM &amp; GPIO模块 | Doongz&#x27;s Site"><meta data-rh="true" name="description" content="来源：https://www.icfedu.cn/?s=RISC-V+LSU%EF%BC%8CSRAM"><meta data-rh="true" property="og:description" content="来源：https://www.icfedu.cn/?s=RISC-V+LSU%EF%BC%8CSRAM"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://doongz.github.io/docs/Skill/ASM/RISC-V/LOAD&amp;STORE-UNIT"><link data-rh="true" rel="alternate" href="https://doongz.github.io/docs/Skill/ASM/RISC-V/LOAD&amp;STORE-UNIT" hreflang="en"><link data-rh="true" rel="alternate" href="https://doongz.github.io/docs/Skill/ASM/RISC-V/LOAD&amp;STORE-UNIT" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Doongz&#39;s Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Doongz&#39;s Site Atom Feed"><link rel="stylesheet" href="/assets/css/styles.99c6e2a1.css">
<link rel="preload" href="/assets/js/runtime~main.f9aa80d1.js" as="script">
<link rel="preload" href="/assets/js/main.0ded408c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Home page</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Notes</a><a class="navbar__item navbar__link" href="/community/support">Community</a><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Courses</a><ul class="dropdown__menu"><li><a href="https://github.com/doongz/mlc-ai" target="_blank" rel="noopener noreferrer" class="dropdown__link">Machine Learning Compilation<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/cs229" target="_blank" rel="noopener noreferrer" class="dropdown__link">Stanford CS229: Machine Learning<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/aics" target="_blank" rel="noopener noreferrer" class="dropdown__link">中国科学院 智能计算系统<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/cs50-ai" target="_blank" rel="noopener noreferrer" class="dropdown__link">Harvard CS50’s Introduction to AI with Python<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/mit-6.824" target="_blank" rel="noopener noreferrer" class="dropdown__link">MIT-6.824 Distributed Systems<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/os-workbench" target="_blank" rel="noopener noreferrer" class="dropdown__link">南京大学 操作系统：设计与实现<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/mit-6.s081" target="_blank" rel="noopener noreferrer" class="dropdown__link">MIT-6.S081 Operating Systems Engineering<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/doongz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Tutorial Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Algorithm/前述/面试时做题技巧">Algorithm</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Competition/比赛">Competition</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Course/CMU-15-213">Course</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Knowledge/IC/IC">Knowledge</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Math/微积分/极限">Math</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/Skill/ASM/RISC-V/汇编语言格式及ABI">Skill</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/Skill/ASM/RISC-V/汇编语言格式及ABI">ASM</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/Skill/ASM/RISC-V/汇编语言格式及ABI">RISC-V</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/汇编语言格式及ABI">汇编语言格式及ABI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/RISC-V简介">RISC-V 简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/通用寄存器和指令">RISC-V 通用寄存器和指令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/扩展寄存器和指令">RISC-V 扩展寄存器和指令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/流水线&amp;硬件模块&amp;译码模块">流水线 &amp; 硬件模块 &amp; 译码模块</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/ALU模块&amp;branch模块">ALU 模块和 branch 模块</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Skill/ASM/RISC-V/LOAD&amp;STORE-UNIT">LSU &amp; SRAM &amp; GPIO模块</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/CSR读写控制">CSR读写控制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/EXU模块和CPU运行">EXU模块和CPU运行</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/RISC-V总线和流水线">RISC-V 总线和流水线</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/RISC-V定时器及中断">RISC-V 定时器及中断</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/riscv-asm-manual">RISC-V Assembly Programmer&#x27;s Manual</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/ASM/x86/X86-64汇编">x86</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/Android/Android概述">Android</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/C/基础知识/数据类型">C</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/C++/基础知识/基本数据类型">C++</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/Golang/基础知识/条件判断">Golang</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/Skill/LaTeX/">LaTex</a><button aria-label="Toggle the collapsible sidebar category &#x27;LaTex&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/Linux/POSIX">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/Skill/Markdown/">README</a><button aria-label="Toggle the collapsible sidebar category &#x27;README&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/Mermaid/">mermaid</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/Python/运算符">Python</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/SQL/数据库理论">SQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/工具链/工具&amp;网站">工具链</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/常用CLI/docker-CLI">常用CLI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/设计模式/多态和多态性">设计模式</a></div></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Skill</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">ASM</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">RISC-V</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">LSU &amp; SRAM &amp; GPIO模块</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>LSU &amp; SRAM &amp; GPIO模块</h1><p>来源：<a href="https://www.icfedu.cn/?s=RISC-V+LSU%EF%BC%8CSRAM" target="_blank" rel="noopener noreferrer">https://www.icfedu.cn/?s=RISC-V+LSU%EF%BC%8CSRAM</a></p><p>RISC-V LSU , SRAM, GPIO 模块，是<strong>利用RISC-V 指令集中的LOAD, STORE 相关的指令集，对memory， 或者外设peripheral 的访存</strong>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一exu_lsu模块">一、exu_lsu模块<a class="hash-link" href="#一exu_lsu模块" title="Direct link to heading">​</a></h2><p>RISC-V 的LOAD, STORE 是由一组指令集组成，包括</p><p>LOAD: LBU, LB, LHU, LH, LW;</p><p>STORE: SB, SH, SW</p><p>两组指令集。</p><p>load，store 指令集可以让risc-v cpu 访存 memory， uart， pwm 等等，很多cpu 外部的存储模块。 这个部分也是一个接口，当前的RISC-V 版本为2.01，在后续的RISC-V fpga 版本中， 会对这个模块进行改造：包括 增加系统总线， 让所有外设都连接到cpu 的内部总线上， 方便各个外设模块的开发。<strong>LSU 模块将形成数据总线地址， 写信号， 读信号， 写数据， 读数据等</strong>。</p><p>RISC-V cpu LSU 架构：</p><p><img loading="lazy" src="/assets/images/96-2a2c61ff89a60c42a66abd16a3e69598.jpeg" width="1838" height="1194" class="img_ev3q"></p><p><img loading="lazy" src="/assets/images/97-6f90031e5e5cb8154f52f7d985236a8c.jpeg" width="1334" height="783" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lsu-相关代码">LSU 相关代码<a class="hash-link" href="#lsu-相关代码" title="Direct link to heading">​</a></h3><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module exu_LSU</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [ 31: 0 ] TMR_BASEADDR  = 32&#x27;h0200_0000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [ 31: 0 ] PLIC_BASEADDR = 32&#x27;h0c00_0000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [ 31: 0 ] CPU_BASEADDR  = 32&#x27;h8000_0000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [ 31: 0 ] MEM_BASEADDR  = 32&#x27;h9000_0000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [ 31: 0 ] GPIO_BASEADDR = 32&#x27;hf000_0000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [ 31: 0 ] UART_BASEADDR = 32&#x27;he000_0000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter MEM_D_DEEP = 1024, //memory data depth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter MEM_D_W    = 32,   //memory data width</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter MEM_MSK_W  = 4,    //memory data mask width</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter MEM_ADDR_W = 32    //memory address width</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input sys_clk,                 // 系统时钟</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//==============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_EXE_vld,               // 执行指令enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// load &amp; store address PC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_D_PC,        // load， store 指向的数据总线 指针</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_LOAD,                  // load 指令集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 4: 0 ] i_load_instr,   // load 指令集包括：{rv32i_lbu,rv32i_lb,rv32i_lhu,rv32i_lh,rv32i_lw};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_STORE,                 // store 指令集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 2: 0 ] i_store_instr,  // store 指令集包括：{rv32i_sb,rv32i_sh,rv32i_sw};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 4: 0 ] i_rd_idx,       // 译码模块 译码出来的rd 通用寄存器id </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_rs2_val,     // rs2 通用寄存器值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//==============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_GPIO_dina,   // gpio 模块a组 cpu写入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_douta, // gpio 模块a组 cpu读出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_ta,    // gpio 模块a组 方向控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_GPIO_dinb,   // gpio 模块b组 cpu写入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_doutb, // gpio 模块b组 cpu读出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_tb,    // gpio 模块b组 方向控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_GPIO_dinc,   // gpio 模块c组 cpu写入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_doutc, // gpio 模块c组 cpu读出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_tc,    // gpio 模块c组 方向控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_GPIO_dind,   // gpio 模块d组 cpu写入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_doutd, // gpio 模块d组 cpu读出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_td,    // gpio 模块d组 方向控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//==============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output txd_start,              // 通知uart 外设模块 写 byte enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 7: 0 ] txd_data,      // 发送到uart 外设模块 写数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input txd_done,                // uart 外设模块 返回的 uart 发送数据完成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//==============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_sft_int_v,  // 软件中断控制寄存器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_timer_l,    // timer 设置寄存器 低32位 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_timer_h,    // timer 设置寄存器 高32位</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_timer_l,     // 读取当前timer 计数器 低32位 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_timer_h,     // 读取当前timer 计数器 高32位</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_tcmp_l,     // timer 比较 寄存器 低32位</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_tcmp_h,     // timer 比较 寄存器 高32位</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 1: 0 ] o_timer_valid, // timer 有效标志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_tm_ctrl,    // timer 控制寄存器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//==============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output o_CPU_cs,               // 普林斯顿架构中 ，选择的数据在 ITCM空间 标识</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_CPU_PC,     // 普林斯顿架构中 ，选择的数据在 ITCM空间 地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_CPU_load_data,// 普林斯顿架构中 ，从ITCM空间读取的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output o_ls_need,              // load或者store 指令 标识</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output o_ls_rdy,               // load 或者 stroe 有效</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output o_rd_wen,               // 写回 通用寄存器 enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 4: 0 ] o_wb_rd_idx,   // 写回 通用寄存器 id </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output reg[ 31: 0 ] o_wb_data, // 写回 通用寄存器 值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_cpu_reset,             // cpu 内核 reset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input rst_n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [31: 0] cpu_data_in = i_rs2_val &lt;&lt; {i_D_PC[1:0],3&#x27;b000};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//==============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Memory section</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire mem_cs = ( i_D_PC[ 31: 16 ] == MEM_BASEADDR[ 31: 16 ] );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg mem_we;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg [ 3: 0 ] mem_wem;        // memory mask</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] mem_dout;     // memory dout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] mem_addr_out; // not at all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//wire mem_init_rdy;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//==============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// GPIO section</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] rb_GPIO_d;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire GPIO_cs = ( i_D_PC[ 31: 16 ] == GPIO_BASEADDR[ 31: 16 ] ) ? 1&#x27;b1 : 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire GPIO_we;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 3: 0 ] GPIO_wem; // gpio mask</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//==============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire UART_cs = ( i_D_PC[ 31: 16 ] == UART_BASEADDR[ 31: 16 ] ) ? 1&#x27;b1 : 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] o_UART_dout;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//==============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire PLIC_cs = ( i_D_PC[ 31: 16 ] == PLIC_BASEADDR[ 31: 16 ] ) ? 1&#x27;b1 : 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] o_PLIC_dout;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//==============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire t_sft_cs   = ( i_D_PC[ 31: 16 ] == TMR_BASEADDR[ 31: 16 ] ) ? 1&#x27;b1 : 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire sft_cs     = t_sft_cs &amp; ( ( ~i_D_PC[ 12 ] ) &amp; ( i_D_PC[ 5: 2 ] == 0 ) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire tm_ctrl_cs = t_sft_cs &amp; ( ( ~i_D_PC[ 12 ] ) &amp; ( i_D_PC[ 5: 2 ] == 1 ) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire t_cs0      = t_sft_cs &amp; ( ( ~i_D_PC[ 12 ] ) &amp; ( i_D_PC[ 5: 2 ] == 2 ) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire t_cs1      = t_sft_cs &amp; ( ( ~i_D_PC[ 12 ] ) &amp; ( i_D_PC[ 5: 2 ] == 3 ) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire tcmp_cs0   = t_sft_cs &amp; ( ( ~i_D_PC[ 12 ] ) &amp; ( i_D_PC[ 5: 2 ] == 4 ) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire tcmp_cs1   = t_sft_cs &amp; ( ( ~i_D_PC[ 12 ] ) &amp; ( i_D_PC[ 5: 2 ] == 5 ) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire fpga_ver_cs  = t_sft_cs &amp; ( i_D_PC[ 12 ] &amp; ( i_D_PC[ 5: 2 ] == 0 ) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire fpga_test_cs = t_sft_cs &amp; ( i_D_PC[ 12 ] &amp; ( i_D_PC[ 5: 2 ] == 1 ) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [31:0] fpga_ver = 32&#x27;h0000_0201;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg [31:0] fpga_test = 32&#x27;h0000_0000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @ (posedge sys_clk) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ( fpga_test_cs )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (mem_wem[0])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fpga_test[ 7: 0] &lt;= cpu_data_in[ 7: 0] ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (mem_wem[1])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fpga_test[15: 8] &lt;= cpu_data_in[15: 8] ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (mem_wem[2])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fpga_test[23:16] &lt;= cpu_data_in[23:16] ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (mem_wem[3])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fpga_test[31:24] &lt;= cpu_data_in[31:24] ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//==============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//assign o_CPU_cs = ( i_D_PC[ 31: 16 ] == CPU_BASEADDR[ 31: 16 ] ) ? i_LOAD &amp; i_EXE_vld : 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg CPU_cs = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @ (*)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(i_EXE_vld)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CPU_cs = ( i_D_PC[ 31: 16 ] == CPU_BASEADDR[ 31: 16 ] ) ? i_LOAD : 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_CPU_cs = CPU_cs;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//assign o_CPU_cs = ( i_D_PC[ 31: 16 ] == CPU_BASEADDR[ 31: 16 ] ) ? i_LOAD : 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_CPU_PC = { i_D_PC[ 31: 2 ], 2&#x27;b00 };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// lock current data address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg [ 1: 0 ] data_sft_r = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @ (posedge sys_clk)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(o_CPU_cs &amp; i_EXE_vld)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_sft_r &lt;= i_D_PC[1:0];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 4: 0 ] data_sft = {data_sft_r[ 1: 0 ], 3&#x27;b000};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//wire [ 4: 0 ] data_sft = {i_D_PC[ 1: 0 ], 3&#x27;b000};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] o_CPU_dout = i_CPU_load_data &gt;&gt; data_sft;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//==============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] ls_rb_d_t_sft = sft_cs         ? o_sft_int_v :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               ( tm_ctrl_cs   ? o_tm_ctrl :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               ( t_cs0        ? i_timer_l :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               ( t_cs1        ? i_timer_h :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               ( fpga_ver_cs  ? fpga_ver :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               ( fpga_test_cs ? (fpga_test&gt;&gt;{i_D_PC[1:0],3&#x27;b000}) :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               ( tcmp_cs0     ? o_tcmp_l :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               ( tcmp_cs1     ? o_tcmp_h : o_CPU_dout ) ) ) ) )));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] ls_rb_d = mem_cs ? mem_dout : ( GPIO_cs ? rb_GPIO_d : ( UART_cs ? o_UART_dout : ls_rb_d_t_sft ) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//wire [ 31: 0 ] ls_rb_d = mem_cs ? mem_dout : ( GPIO_cs ? rb_GPIO_d : ( UART_cs ? o_UART_dout : o_CPU_dout ) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always@( * )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mem_we &lt;= 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mem_wem &lt;= 4&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    o_wb_data &lt;= 32&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ( i_LOAD )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin //&amp;mem_init_rdy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case ( i_load_instr ) // i_load_instr ={rv32i_lbu, rv32i_lb, rv32i_lhu, rv32i_lh, rv32i_lw};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        5&#x27;b00001:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin //rv32i_lw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            o_wb_data &lt;= ls_rb_d;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        5&#x27;b00010:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin //rv32i_lh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            o_wb_data &lt;= { { 16{ ls_rb_d[ 15 ] } }, ls_rb_d[ 15: 0 ] };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        5&#x27;b00100:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin //rv32i_lhu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            o_wb_data &lt;= { { 16{ 1&#x27;b0 } }, ls_rb_d[ 15: 0 ] };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        5&#x27;b01000:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin //rv32i_lb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            o_wb_data &lt;= { { 24{ ls_rb_d[ 7 ] } }, ls_rb_d[ 7: 0 ] };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        5&#x27;b10000:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin //rv32i_lbu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            o_wb_data &lt;= { { 24{ 1&#x27;b0 } }, ls_rb_d[ 7: 0 ] };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default: ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        endcase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ( i_STORE )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin //&amp;mem_init_rdy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mem_we &lt;= 1&#x27;b1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case ( i_store_instr ) //i_store_instr ={rv32i_sb, rv32i_sh, rv32i_sw};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        3&#x27;b001:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin //rv32i_sw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mem_wem &lt;= 4&#x27;b1111; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        3&#x27;b010:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin //rv32i_sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mem_wem &lt;= 4&#x27;b0011 &lt;&lt; {i_D_PC[1],1&#x27;b0}; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        3&#x27;b100:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin //rv32i_sb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mem_wem &lt;= 4&#x27;b0001 &lt;&lt; i_D_PC[1:0]; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mem_wem &lt;= 4&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        endcase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//==============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">D_sram</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .MEM_D_DEEP ( MEM_D_DEEP ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .MEM_D_W    ( MEM_D_W ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .MEM_MSK_W  ( MEM_MSK_W ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .MEM_ADDR_W ( MEM_ADDR_W )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">D_sram_inst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .clk   ( sys_clk ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .rst_n ( rst_n ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .din   ( cpu_data_in ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .addr  ( i_D_PC ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .dout  ( mem_dout ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .cs    ( mem_cs ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .we    ( mem_we ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .wem   ( mem_wem ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//.mem_init_rdy (mem_init_rdy),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_D_PC ( mem_addr_out ) //not at all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//==============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign GPIO_we = mem_we;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign GPIO_wem = mem_wem;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fii_GPIO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .GPIO_DEEP   ( 8 ), // register number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .GPIO_W      ( MEM_D_W ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .GPIO_MSK_W  ( MEM_MSK_W ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .GPIO_ADDR_W ( MEM_ADDR_W )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) fii_GPIO_inst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .clk          ( sys_clk ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .rst_n        ( rst_n ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_ls_GPIO_din  ( cpu_data_in ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_rb_GPIO_dout ( rb_GPIO_d ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_addr       ( i_D_PC ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_cs         ( GPIO_cs ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_we         ( GPIO_we ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_wem        ( GPIO_wem ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_GPIO_dina  ( i_GPIO_dina ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_GPIO_douta ( o_GPIO_douta ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_GPIO_ta    ( o_GPIO_ta ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_GPIO_dinb  ( i_GPIO_dinb ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_GPIO_doutb ( o_GPIO_doutb ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_GPIO_tb    ( o_GPIO_tb ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_GPIO_dinc  ( i_GPIO_dinc ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_GPIO_doutc ( o_GPIO_doutc ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_GPIO_tc    ( o_GPIO_tc ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_GPIO_dind  ( i_GPIO_dind ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_GPIO_doutd ( o_GPIO_doutd ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_GPIO_td    ( o_GPIO_td )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire UART_we = mem_we;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire UART_wem = mem_wem;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fii_UART fii_UART_inst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .clk         ( sys_clk ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_PERI_din  ( cpu_data_in ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_PERI_dout ( o_UART_dout ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_addr      ( i_D_PC ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_cs        ( UART_cs ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_we        ( UART_we ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_wem       ( UART_wem ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .txd_start   ( txd_start ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .txd_data    ( txd_data ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .txd_done    ( txd_done ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .rst_n       ( rst_n )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire tmr_sft_we = mem_we;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fii_timer_lsu fii_timer_lsu_inst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .clk             ( sys_clk ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_sft_timer_din ( cpu_data_in ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_tmr_sft_we    ( tmr_sft_we ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_tm_ctrl_cs    ( tm_ctrl_cs ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_tm_ctrl       ( o_tm_ctrl ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_sft_cs        ( sft_cs ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_sft_int_v     ( o_sft_int_v ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_tcs0          ( t_cs0 ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_timer_l       ( o_timer_l ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_tcs1          ( t_cs1 ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_timer_h       ( o_timer_h ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_tcmp_cs0      ( tcmp_cs0 ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_tcmp_l        ( o_tcmp_l ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_tcmp_cs1      ( tcmp_cs1 ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_tcmp_h        ( o_tcmp_h ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_timer_valid   ( o_timer_valid ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .rst_n           ( rst_n &amp; (!i_cpu_reset))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_rd_wen  = i_LOAD; //o_wb_need</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_ls_need = i_LOAD | i_STORE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_ls_rdy  = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_wb_rd_idx = i_rd_idx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endmodule</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="代码分析">代码分析<a class="hash-link" href="#代码分析" title="Direct link to heading">​</a></h3><p><strong>端口描述：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">input i_EXE_vld,          // 执行指令enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// load &amp; store address PC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_D_PC,     // load， store 指向的数据总线 指针</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_LOAD,            // load 指令集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 4: 0 ] i_load_instr,  // load 指令集包括：{rv32i_lbu, rv32i_lb, rv32i_lhu, rv32i_lh, rv32i_lw};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_STORE,           // store 指令集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 2: 0 ] i_store_instr, // store 指令集包括：{rv32i_sb, rv32i_sh, rv32i_sw};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 4: 0 ] i_rd_idx,     // 译码模块 译码出来的rd 通用寄存器id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_rs2_val,    // rs2 通用寄存器值</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上这些信号和 cpu 内核相关， 都是从译码模块 和 执行模块 过来的。</p><p><strong>gpio 组 端口：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_GPIO_dina,        // gpio 模块a组 cpu写入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_douta,  // gpio 模块a组 cpu读出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_ta,         // gpio 模块a组 方向控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_GPIO_dinb,       // gpio 模块b组 cpu写入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_doutb, // gpio 模块b组 cpu读出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_tb,        // gpio 模块b组 方向控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_GPIO_dinc,        // gpio 模块c组 cpu写入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_doutc,  // gpio 模块c组 cpu读出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_tc,         // gpio 模块c组 方向控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_GPIO_dind,        // gpio 模块d组 cpu写入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_doutd,  // gpio 模块d组 cpu读出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_td,         // gpio 模块d组 方向控制</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在当前LSU模块接口中， 我们设计了gpio 的外设， 定义了4个组 gpio a，b， c， d 。 其中每一个组内包括32个gpio pin 。 所有gpio pin 都是 inout ，这些信号在整个工程的顶层模块有相关的定义来配合 gpio 组端口。</p><p>整个RISC-V 工程的<strong>顶层模块</strong>示例：</p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fii_iobuf #( .IO_WIDTH( 32 ) )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fii_iobuf_insta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_dio_t  ( gpio_ta ),  // 对应当前模块的 o_GPIO_ta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_dio    ( gpio_oa ),  // 对应当前模块的 o_GPIO_douta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_dio    ( gpio_ia ),  // 对应当前模块的 o_GPIO_dina</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .io_dio_p ( gpio_a )    // 对应fpga 真正的PIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>uart 模块端口：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">output txd_start,          // 通知uart 外设模块 写 byte enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 7: 0 ] txd_data,  // 发送到uart 外设模块 写数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input txd_done,            // uart 外设模块 返回的 uart 发送数据完成</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在当前LSU模块接口中，我们定义了uart 模块。 这些接口 一端 和 cpu load，store信号 接口， 另外一端 txd_start, txd_data, txd_done 将连接到真正的uart 通讯模块。</p><p><strong>timer 接口：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_sft_int_v,   // 软件中断控制寄存器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_timer_l,     // timer 设置寄存器 低32位</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_timer_h,     // timer 设置寄存器 高32位</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_timer_l,      // 读取当前timer 计数器 低32位</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_timer_h,      // 读取当前timer 计数器 高32位</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_tcmp_l,      // timer 比较 寄存器 低32位</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_tcmp_h,      // timer 比较 寄存器 高32位</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 1: 0 ] o_timer_valid,  // timer 有效标志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_tm_ctrl,     // timer 控制寄存器</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在当前的LSU 模块接口中， 我们定义了timer 模块。</p><p><strong>ITCM 模块的接口：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">output o_CPU_cs,                 // 普林斯顿架构中 ，选择的数据在 ITCM空间 标识</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_CPU_PC,       // 普林斯顿架构中 ，选择的数据在 ITCM空间 地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_CPU_load_data, // 普林斯顿架构中 ，从ITCM空间读取的数据</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这几个信号用于读取相关的数据， 在我们使用汇编指令时，有时 load 的数据 正好在ITCM 区域， 这时， 指令pc 就需要跳转到itcm 数据端， 将数据读出（不认为读出数据时指令机器码），读出之后， 在将pc 还原会当中正在执行代码的pc 值。</p><p><strong>外部接口信号：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">output o_ls_need,  // load或者store 指令 标识，为其他模块做指示。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output o_ls_rdy,   // load 或者 stroe 有效 ，这个信号一直为一。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>通用寄存器写回 端口:</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">output o_rd_wen,                // 写回 通用寄存器 enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 4: 0 ] o_wb_rd_idx,    // 写回 通用寄存器 id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output reg[ 31: 0 ] o_wb_data,  // 写回 通用寄存器 值</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>代码分析：</strong></p><p>wire <!-- -->[31: 0]<!-- --> cpu_data_in = i_rs2_val &lt;&lt; {i_D_PC<!-- -->[1:0]<!-- -->,3’b000};</p><p>在store 相关的指令包括 SB, SH, SW ,其中：</p><p>SB 的地址 （i_D_PC) 可以时 0 – 4G 的任何地址。 注意：这个地址是哈佛架构中的数据地址，（没有像指令地址那样： RV32 必须是 4bytes 对齐的， RV32C 中 可以有2bytes 对齐的），它可以是任何地址 ，例如： 0x9000_00000, 0x9000_00001, 0x9000_00002, 0x9000_00003。没有对齐一说。sb 指令可以访问任何一个地址。 所以 我们会分析i_D_PC<!-- -->[1:0]<!-- -->, 它有4种选择：</p><p>2’b00:  表示当前地址正好是4bytes 对齐的（地址可以被4 整除）， 正好对应的数据为 i_rs2_val<!-- -->[7:0]<!-- --> ， 左移 0 位</p><p>2’b01: 表示当前地址被4 整除后 余数 1， 将数据为 i_rs2_val<!-- -->[7:0]<!-- --> ， 左移 8 位</p><p>2’b10: 表示当前地址被4 整除后 余数 2， 将数据为 i_rs2_val<!-- -->[7:0]<!-- --> ， 左移 16 位</p><p>2b’11: 表示当前地址被4 整除后 余数 3， 将数据为 i_rs2_val<!-- -->[7:0]<!-- --> ， 左移 24 位</p><p>SH 的地址和上面的情况类似， 只是只有 2’00, 2’b10 这2种情况而已。</p><p>SW 的地址和上面的情况类似， 只是只有 2’00, 这1种情况而已。</p><p><strong>memory 段:</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wire mem_cs = ( i_D_PC[ 31: 16 ] == MEM_BASEADDR[ 31: 16 ] );  //片选信号， 对应的正好是DTCM 地址空间。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg mem_we; // store 指令组中，任何一个有效(sb,sh,sw) , 当前这个信号有效</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg [ 3: 0 ] mem_wem; // 写屏蔽， 4bit， 任何一个bit 位 1， 相应的数据被写入到DTCM。举例： mem_wem = 4’b0100, 那么 cpu_data_in[23:16] 被写入到DTCM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] mem_dout; // 从dtcm 中读取数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] mem_addr_out; // 目前没有使用。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>gpio 段：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] rb_GPIO_d; // 从gpio 寄存器中读出的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire GPIO_cs = ( i_D_PC[ 31: 16 ] == GPIO_BASEADDR[ 31: 16 ] ) ? 1’b1 : 1’b0; // gpio 寄存器 片选</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire GPIO_we; // gpio 寄存器 写信号 和 mem_we 一样使用。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 3: 0 ] GPIO_wem; // gpio 寄存器 写屏蔽 ，和 mem_wem 使用一样</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>uart 段：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wire UART_cs = ( i_D_PC[ 31: 16 ] == UART_BASEADDR[ 31: 16 ] ) ? 1’b1 : 1’b0;  // uart 寄存器组 片选</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] o_UART_dout;  // uart 寄存器 中读出的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire PLIC_cs = ( i_D_PC[ 31: 16 ] == PLIC_BASEADDR[ 31: 16 ] ) ? 1’b1 : 1’b0;  // 目前没有使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] o_PLIC_dout;   // 目前没有使用</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>timer 寄存器 片选：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wire t_sft_cs   = ( i_D_PC[ 31: 16 ] == TMR_BASEADDR[ 31: 16 ] ) ? 1&#x27;b1 : 1&#x27;b0;  // timer 寄存器组段 片选</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire sft_cs     = t_sft_cs &amp; ( ( ~i_D_PC[ 12 ] ) &amp; ( i_D_PC[ 5: 2 ] == 0 ) );    // 软件中断 选择</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire tm_ctrl_cs = t_sft_cs &amp; ( ( ~i_D_PC[ 12 ] ) &amp; ( i_D_PC[ 5: 2 ] == 1 ) );    // timer 控制寄存器 选择</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire t_cs0      = t_sft_cs &amp; ( ( ~i_D_PC[ 12 ] ) &amp; ( i_D_PC[ 5: 2 ] == 2 ) );    // timer 寄存器 低32位选择</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire t_cs1      = t_sft_cs &amp; ( ( ~i_D_PC[ 12 ] ) &amp; ( i_D_PC[ 5: 2 ] == 3 ) );    // timer 寄存器 高32位选择</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire tcmp_cs0   = t_sft_cs &amp; ( ( ~i_D_PC[ 12 ] ) &amp; ( i_D_PC[ 5: 2 ] == 4 ) );    // timer比较寄存器低32位 选择</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire tcmp_cs1   = t_sft_cs &amp; ( ( ~i_D_PC[ 12 ] ) &amp; ( i_D_PC[ 5: 2 ] == 5 ) );    // timer比较寄存器高32位 选择</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>版本和测试寄存器片选：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wire fpga_ver_cs  = t_sft_cs &amp; ( i_D_PC[ 12 ] &amp; ( i_D_PC[ 5: 2 ] == 0 ) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire fpga_test_cs = t_sft_cs &amp; ( i_D_PC[ 12 ] &amp; ( i_D_PC[ 5: 2 ] == 1 ) );</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>测试寄存器写：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">always @ (posedge sys_clk)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ( fpga_test_cs )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (mem_wem[0])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fpga_test[ 7: 0] &lt;= cpu_data_in[ 7: 0] ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (mem_wem[1])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fpga_test[15: 8] &lt;= cpu_data_in[15: 8] ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (mem_wem[2])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fpga_test[23:16] &lt;= cpu_data_in[23:16] ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (mem_wem[3])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fpga_test[31:24] &lt;= cpu_data_in[31:24] ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>load ITCM 中的数据：</strong></p><p>普林斯顿架构中会使用, 通知 itcm ，当前需要从itcm 区域中读取一个数据（不是指令）</p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reg CPU_cs = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @ (*)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(i_EXE_vld)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CPU_cs = ( i_D_PC[ 31: 16 ] == CPU_BASEADDR[ 31: 16 ] ) ? i_LOAD : 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_CPU_cs = CPU_cs;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_CPU_PC = { i_D_PC[ 31: 2 ], 2&#x27;b00 };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg [ 1: 0 ] data_sft_r = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @ (posedge sys_clk)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(o_CPU_cs &amp; i_EXE_vld)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_sft_r &lt;= i_D_PC[1:0];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 4: 0 ] data_sft = {data_sft_r[ 1: 0 ], 3&#x27;b000};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] o_CPU_dout = i_CPU_load_data &gt;&gt; data_sft;  // 从itcm 中读取的数据 来对用LB, LH, LW 等等。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>整个模块的 load 指令集 读出的数据选择， 根据不同的片选信号， 从不同的模块中，将相应的数据送给cpu</p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] ls_rb_d_t_sft = sft_cs       ? o_sft_int_v :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             ( tm_ctrl_cs   ? o_tm_ctrl :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             ( t_cs0        ? i_timer_l :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             ( t_cs1        ? i_timer_h :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             ( fpga_ver_cs  ? fpga_ver :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             ( fpga_test_cs ? (fpga_test&gt;&gt;{i_D_PC[1:0],3&#x27;b000}) :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             ( tcmp_cs0     ? o_tcmp_l :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             ( tcmp_cs1     ? o_tcmp_h : o_CPU_dout ) ) ) ) )));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] ls_rb_d = mem_cs ? mem_dout : ( GPIO_cs ? rb_GPIO_d : ( UART_cs ? o_UART_dout : ls_rb_d_t_sft ) );</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>LOAD, STORE 指令集组 读写操作：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">always@( * )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mem_we &lt;= 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mem_wem &lt;= 4&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    o_wb_data &lt;= 32&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ( i_LOAD )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin //&amp;mem_init_rdy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case ( i_load_instr ) // i_load_instr ={rv32i_lbu, rv32i_lb, rv32i_lhu, rv32i_lh, rv32i_lw};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        5&#x27;b00001:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin //rv32i_lw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            o_wb_data &lt;= ls_rb_d;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        5&#x27;b00010:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin //rv32i_lh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            o_wb_data &lt;= { { 16{ ls_rb_d[ 15 ] } }, ls_rb_d[ 15: 0 ] };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        5&#x27;b00100:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin //rv32i_lhu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            o_wb_data &lt;= { { 16{ 1&#x27;b0 } }, ls_rb_d[ 15: 0 ] };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        5&#x27;b01000:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin //rv32i_lb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            o_wb_data &lt;= { { 24{ ls_rb_d[ 7 ] } }, ls_rb_d[ 7: 0 ] };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        5&#x27;b10000:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin //rv32i_lbu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            o_wb_data &lt;= { { 24{ 1&#x27;b0 } }, ls_rb_d[ 7: 0 ] };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default: ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        endcase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ( i_STORE )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin //&amp;mem_init_rdy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mem_we &lt;= 1&#x27;b1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case ( i_store_instr ) //i_store_instr ={rv32i_sb, rv32i_sh, rv32i_sw};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        3&#x27;b001:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin //rv32i_sw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mem_wem &lt;= 4&#x27;b1111;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        3&#x27;b010:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin //rv32i_sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mem_wem &lt;= 4&#x27;b0011 &lt;&lt; {i_D_PC[1],1&#x27;b0};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        3&#x27;b100:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin //rv32i_sb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mem_wem &lt;= 4&#x27;b0001 &lt;&lt; i_D_PC[1:0];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mem_wem &lt;= 4&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        endcase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>根据LOAD, STORE 指令集组， 将相关的数据写入，或者读出。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二d_sram模块">二、D_sram模块<a class="hash-link" href="#二d_sram模块" title="Direct link to heading">​</a></h2><p>RISC-V CPU中 LOAD, STORE 指令集中对SRAM， 和 GPIO 模块的控制，SRAM ,GPIO 等，都可以看做cpu 的外部存储。在哈佛架构中， 使用数据总线，访存这些外部模块</p><p><strong>在 RISC-V v2.01 版本中， SRAM, GPIO 等模块在 lsu 模块 当中</strong>， lsu 模块作为和cpu 内核连接的接口， 在之后的版本中会做相应的修改， 包括增加总线。 包括总线扩展。 同时将其他外设从当前模块中移出，以便增加更多的外设。目前sram 在地址空间的位置是 0x9000_0000 起始的 256M 空间。SRAM 和 DTCM 是一致的。目前版本中， DTCM 就是由SRAM 这个模块组成的。</p><p><img loading="lazy" src="/assets/images/98-14919bfe099ac1765ea6d845664afcab.jpeg" width="1852" height="1246" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sram-代码">SRAM 代码<a class="hash-link" href="#sram-代码" title="Direct link to heading">​</a></h3><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module D_sram</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#( </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter MEM_D_DEEP = 1024, //memory data depth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter MEM_D_W = 32,      //memory data width</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter MEM_MSK_W = 4,     //memory data mask width</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter MEM_ADDR_W = 32    //memory address width</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input clk,                            // 系统时钟 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input [ MEM_D_W - 1 : 0 ] din,        // 数据写入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input [ MEM_ADDR_W - 1 : 0 ] addr,    // 数据总线地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ MEM_ADDR_W - 1 : 0 ] o_D_PC, // 没有使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input cs,                             // 模块片选</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input we,                             // 写信号 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input [ MEM_MSK_W - 1: 0 ] wem,       // 写屏蔽位 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//    output reg mem_init_rdy, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ MEM_D_W - 1: 0 ] dout,       // 数据读</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input rst_n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg [ MEM_D_W - 1: 0 ] mem_r[ 0: MEM_D_DEEP - 1 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire ren = cs &amp; ( ~we );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ MEM_MSK_W - 1: 0 ] wen = ( { MEM_MSK_W{ cs &amp; we } } &amp; wem );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg [ MEM_ADDR_W - 1: 0 ] addr_r = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @( posedge clk )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">addr_r &lt;= addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ MEM_ADDR_W - 1: 0 ] addr_mem = {addr[31:2]};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// integer mem_init_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">genvar wi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( wi = 0; wi &lt; MEM_MSK_W; wi = wi + 1 )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin: mem_write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    always @( posedge clk )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if ( wen[ wi ] )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mem_r[ addr_mem ][ 8 * wi + 7: 8 * wi ] &lt;= din[ 8 * wi + 7: 8 * wi ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endgenerate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ MEM_D_W - 1: 0 ] dout_pre;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ MEM_D_W - 1: 0 ] dout_w;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//assign dout_pre = mem_r[ addr_r ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign dout_pre = mem_r[ addr_mem ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">genvar ri;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for ( ri = 0; ri &lt; MEM_D_W; ri = ri + 1 )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin: mem_read</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`ifdef SIM//{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        assign dout_w[ ri ] = ( dout_pre[ ri ] === 1&#x27;bx ) ? 1&#x27;b0 : dout_pre[ ri ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`else //}{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        assign dout_w[ ri ] = dout_pre[ ri ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`endif//}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endgenerate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//wire [4:0] data_sft = addr[1:0] * 8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [4:0] data_sft = {addr[1:0], 3&#x27;b000};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign dout = dout_w &gt;&gt; data_sft;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_D_PC = addr_r;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endmodule</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="代码分析-1">代码分析<a class="hash-link" href="#代码分析-1" title="Direct link to heading">​</a></h3><p><strong>端口介绍：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">input clk,                         // 系统时钟 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ MEM_D_W - 1 : 0 ] din,     // 数据写入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ MEM_ADDR_W - 1 : 0 ] addr, // 数据总线地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input cs,                          // 模块片选</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input we,                          // 写信号 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ MEM_MSK_W - 1: 0 ] wem,    // 写屏蔽位 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ MEM_D_W - 1: 0 ] dout,    // 数据读</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>存储寄存器：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reg [ MEM_D_W – 1: 0 ] mem_r[ 0: MEM_D_DEEP – 1 ];</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>读信号， 写信号：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wire ren = cs &amp; ( ~we );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ MEM_MSK_W – 1: 0 ] wen = ( { MEM_MSK_W{ cs &amp; we } } &amp; wem );</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>SRAM 地址：</strong> </p><p>由于当前设备位32bit的设备， 所以输入地址只需要<!-- -->[31:2]<!-- --> ,作为访存的单元。</p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wire [ MEM_ADDR_W – 1: 0 ] addr_mem = {addr[31:2]};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>写数据到存储单元：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">genvar wi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( wi = 0; wi &lt; MEM_MSK_W; wi = wi + 1 )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin: mem_write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    always @( posedge clk )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if ( wen[ wi ] )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mem_r[ addr_mem ][ 8 * wi + 7: 8 * wi ] &lt;= din[ 8 * wi + 7: 8 * wi ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endgenerate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>读数据单元：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wire [ MEM_D_W - 1: 0 ] dout_pre;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ MEM_D_W - 1: 0 ] dout_w;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//assign dout_pre = mem_r[ addr_r ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign dout_pre = mem_r[ addr_mem ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">genvar ri;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for ( ri = 0; ri &lt; MEM_D_W; ri = ri + 1 )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin: mem_read</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`ifdef SIM//{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assign dout_w[ ri ] = ( dout_pre[ ri ] === 1&#x27;bx ) ? 1&#x27;b0 : dout_pre[ ri ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`else //}{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assign dout_w[ ri ] = dout_pre[ ri ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`endif//}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endgenerate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>load 指令相关操作：</strong> LB, LH, LW</p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wire [4:0] data_sft = {addr[1:0], 3&#x27;b000};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign dout = dout_w &gt;&gt; data_sft;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>整个SRAM 模块 目前是由d触发器组成， 之后也可以被替换位block memory （IP), 但要注意， block memory 通常需要延迟一个时钟周期，所以在整个cpu 设计中， 一定要注意，需要在状态机，或者流水线中增加一个时钟，作为访存。当然也有其他的方法可以使用。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三fii_gpio模块">三、fii_GPIO模块<a class="hash-link" href="#三fii_gpio模块" title="Direct link to heading">​</a></h2><p>RISC-V CPU中 LOAD, STORE 指令集中对SRAM， 和 GPIO 模块的控制，SRAM ,GPIO 等，都可以看做cpu 的外部存储。在哈佛架构中， 使用数据总线，访存这些外部模块</p><p>GPIO 的地址空间：</p><p><img loading="lazy" src="/assets/images/99-a13335f4e7cf9f9b1b019955fcd98fa1.jpeg" width="671" height="246" class="img_ev3q"></p><p>gpio 寄存器地址空间是从0xf000_0000 开始的8k 地址空间。</p><p><img loading="lazy" src="/assets/images/100-c50aba5bf67b9aade8beed443ebaaa76.jpeg" width="1814" height="1250" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gpio-模块代码">gpio 模块代码<a class="hash-link" href="#gpio-模块代码" title="Direct link to heading">​</a></h3><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module fii_GPIO </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter GPIO_DEEP   = 8,  //memory data width</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter GPIO_W      = 32, //memory data width</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter GPIO_MSK_W  = 4,  //memory data mask width</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter GPIO_ADDR_W = 32  //memory address width</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input clk,                                // 系统时钟</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input rst_n,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input [ GPIO_W - 1 : 0 ] i_ls_GPIO_din,   // cpu 写数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ GPIO_W - 1 : 0 ] o_rb_GPIO_dout, // cpu 读数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input [ GPIO_ADDR_W - 1 : 0 ] i_addr,     // 数据总线地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input i_cs,                               // gpio 模块 片选</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input i_we,                               // 写信号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input [ GPIO_MSK_W - 1: 0 ] i_wem,        // 写屏蔽信号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// t = 0, output; t = 1, input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input [ 31: 0 ] i_GPIO_dina,              // gpio 模块a组 cpu写入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ 31: 0 ] o_GPIO_douta,            // gpio 模块a组 cpu读出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ 31: 0 ] o_GPIO_ta,               // gpio 模块a组 方向控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input [ 31: 0 ] i_GPIO_dinb,              // gpio 模块b组 cpu写入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ 31: 0 ] o_GPIO_doutb,            // gpio 模块b组 cpu读出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ 31: 0 ] o_GPIO_tb,               // gpio 模块b组 方向控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input [ 31: 0 ] i_GPIO_dinc,              // gpio 模块c组 cpu写入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ 31: 0 ] o_GPIO_doutc,            // gpio 模块c组 cpu读出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ 31: 0 ] o_GPIO_tc,               // gpio 模块c组 方向控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input [ 31: 0 ] i_GPIO_dind,              // gpio 模块d组 cpu写入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ 31: 0 ] o_GPIO_doutd,            // gpio 模块d组 cpu读出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ 31: 0 ] o_GPIO_td                // gpio 模块d组 方向控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg [ GPIO_W - 1: 0 ] GPIO_r [ 0: GPIO_DEEP - 1 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ GPIO_MSK_W - 1: 0 ] wen;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire ren;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 2: 0 ] w_addr = i_addr[ 4: 2 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign ren = i_cs &amp; ( ~i_we );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign wen = ( { GPIO_MSK_W{ i_cs &amp; i_we } } &amp; i_wem );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg [ GPIO_ADDR_W - 1: 0 ] addr_r = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always@( posedge clk )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ( ren )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addr_r &lt;= i_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg [7:0] i = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">initial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for ( i = 0; i &lt; GPIO_DEEP; i = i + 1 )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin:IO_GPIO_INIT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GPIO_r [ i ] &lt;= ~0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">genvar wi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for ( wi = 0; wi &lt; GPIO_MSK_W; wi = wi + 1 )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin:IO_write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        always @( posedge clk )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           if ( wen[ wi ] )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               GPIO_r[ w_addr ][ 8 * wi + 7: 8 * wi ] &lt;= i_ls_GPIO_din[ 8 * wi + 7: 8 * wi ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endgenerate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ GPIO_W - 1: 0 ] dout_pre;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ GPIO_W - 1: 0 ] t_pre;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ GPIO_W - 1: 0 ] reg_dout;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ GPIO_W - 1: 0 ] in_dout[ 0: GPIO_DEEP / 2 - 1 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign in_dout[ 0 ] = i_GPIO_dina;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign in_dout[ 1 ] = i_GPIO_dinb;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign in_dout[ 2 ] = i_GPIO_dinc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign in_dout[ 3 ] = i_GPIO_dind;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//wire [ 31: 0 ] in_dout_tmp = in_dout[ i_addr[ GPIO_DEEP / 2 - 1: 1 ] ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] in_dout_tmp = in_dout[ w_addr[ 2: 1 ]];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//assign t_pre = GPIO_r[ { addr_r[ GPIO_ADDR_W - 1: 1 ], 1&#x27;b1 } ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//assign dout_pre = GPIO_r[ { addr_r[ GPIO_ADDR_W - 1: 1 ], 1&#x27;b0 } ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign t_pre = GPIO_r[ { w_addr[ 2: 1 ], 1&#x27;b1 } ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign dout_pre = GPIO_r[ { w_addr[ 2: 1 ], 1&#x27;b0 } ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">genvar rbi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for ( rbi = 0; rbi &lt; GPIO_W; rbi = rbi + 1 )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin:GPIO_readb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // input reg output reg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        assign o_rb_GPIO_dout[ rbi ] = t_pre[ rbi ] ? in_dout_tmp[ rbi ] : dout_pre[ rbi ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endgenerate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_GPIO_douta = GPIO_r[ 0 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_GPIO_ta    = GPIO_r[ 1 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_GPIO_doutb = GPIO_r[ 2 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_GPIO_tb    = GPIO_r[ 3 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_GPIO_doutc = GPIO_r[ 4 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_GPIO_tc    = GPIO_r[ 5 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_GPIO_doutd = GPIO_r[ 6 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_GPIO_td    = GPIO_r[ 7 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endmodule</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="代码分析-2">代码分析<a class="hash-link" href="#代码分析-2" title="Direct link to heading">​</a></h3><p><strong>端口介绍：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">input [ GPIO_W - 1 : 0 ] i_ls_GPIO_din,   // cpu 写数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ GPIO_W - 1 : 0 ] o_rb_GPIO_dout, // cpu 读数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ GPIO_ADDR_W - 1 : 0 ] i_addr,     // 数据总线地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_cs, // gpio 模块 片选</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_we, // 写信号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ GPIO_MSK_W - 1: 0 ] i_wem,        // 写屏蔽信号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_GPIO_dina,              // gpio 模块a组 cpu写入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_douta,            // gpio 模块a组 cpu读出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_ta,               // gpio 模块a组 方向控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_GPIO_dinb,              // gpio 模块b组 cpu写入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_doutb,            // gpio 模块b组 cpu读出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_tb,               // gpio 模块b组 方向控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_GPIO_dinc,              // gpio 模块c组 cpu写入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_doutc,            // gpio 模块c组 cpu读出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_tc,               // gpio 模块c组 方向控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [ 31: 0 ] i_GPIO_dind,              // gpio 模块d组 cpu写入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_doutd,            // gpio 模块d组 cpu读出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [ 31: 0 ] o_GPIO_td                // gpio 模块d组 方向控制</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>定义gpio 寄存器组：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reg [ GPIO_W - 1: 0 ] GPIO_r [ 0: GPIO_DEEP - 1 ];</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>定义读，写，地址信号：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wire [ GPIO_MSK_W – 1: 0 ] wen;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire ren;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 2: 0 ] w_addr = i_addr[ 4: 2 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign ren = i_cs &amp; ( ~i_we );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign wen = ( { GPIO_MSK_W{ i_cs &amp; i_we } } &amp; i_wem );</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>gpio 模块寄存器组，写逻辑：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">genvar wi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for ( wi = 0; wi &lt; GPIO_MSK_W; wi = wi + 1 )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin:IO_write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        always @( posedge clk )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if ( wen[ wi ] )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                GPIO_r[ w_addr ][ 8 * wi + 7: 8 * wi ] &lt;= i_ls_GPIO_din[ 8 * wi + 7: 8 * wi ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endgenerate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>读取gpio组中的方向寄存器， 数据寄存器：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wire [ GPIO_W - 1: 0 ] dout_pre;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ GPIO_W - 1: 0 ] t_pre;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ GPIO_W - 1: 0 ] reg_dout;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ GPIO_W - 1: 0 ] in_dout[ 0: GPIO_DEEP / 2 - 1 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign in_dout[ 0 ] = i_GPIO_dina;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign in_dout[ 1 ] = i_GPIO_dinb;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign in_dout[ 2 ] = i_GPIO_dinc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign in_dout[ 3 ] = i_GPIO_dind;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] in_dout_tmp = in_dout[ w_addr[ 2: 1 ]];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign t_pre = GPIO_r[ { w_addr[ 2: 1 ], 1&#x27;b1 } ];     // 当前地址选中的GPIO ,A,B,C,D 组中 方向寄存器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign dout_pre = GPIO_r[ { w_addr[ 2: 1 ], 1&#x27;b0 } ];  // 读取当前地址选中的GPIO ,A,B,C,D 组中gpio 值寄存器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>cpu 写gpio 寄存器组</strong>：</p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">genvar wi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for ( wi = 0; wi &lt; GPIO_MSK_W; wi = wi + 1 )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin:IO_write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        always @( posedge clk )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if ( wen[ wi ] )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                GPIO_r[ w_addr ][ 8 * wi + 7: 8 * wi ] &lt;= i_ls_GPIO_din[ 8 * wi + 7: 8 * wi ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endgenerate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>cpu 读取gpio 寄存器组中的内容：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">genvar rbi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for ( rbi = 0; rbi &lt; GPIO_W; rbi = rbi + 1 )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin:GPIO_readb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //                                                input reg            output reg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        assign o_rb_GPIO_dout[ rbi ] = t_pre[ rbi ] ? in_dout_tmp[ rbi ] : dout_pre[ rbi ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endgenerate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当t_pre == 1 时， 读取 input fpga pin 的数值；当t_pre == 0 时， 读取 当前gpio数值寄存器中的值；</p><p><img loading="lazy" src="/assets/images/101-e46f137fac5e94fedbee56f0a365555c.jpeg" width="1046" height="597" class="img_ev3q"></p><p><strong>将gpio 寄存器组的相关内容输出到顶层文件的原语中：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">assign o_GPIO_douta = GPIO_r[ 0 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_GPIO_ta    = GPIO_r[ 1 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_GPIO_doutb = GPIO_r[ 2 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_GPIO_tb    = GPIO_r[ 3 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_GPIO_doutc = GPIO_r[ 4 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_GPIO_tc    = GPIO_r[ 5 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_GPIO_doutd = GPIO_r[ 6 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_GPIO_td    = GPIO_r[ 7 ];</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Skill/ASM/RISC-V/ALU模块&amp;branch模块"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ALU 模块和 branch 模块</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Skill/ASM/RISC-V/CSR读写控制"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CSR读写控制</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一exu_lsu模块" class="table-of-contents__link toc-highlight">一、exu_lsu模块</a><ul><li><a href="#lsu-相关代码" class="table-of-contents__link toc-highlight">LSU 相关代码</a></li><li><a href="#代码分析" class="table-of-contents__link toc-highlight">代码分析</a></li></ul></li><li><a href="#二d_sram模块" class="table-of-contents__link toc-highlight">二、D_sram模块</a><ul><li><a href="#sram-代码" class="table-of-contents__link toc-highlight">SRAM 代码</a></li><li><a href="#代码分析-1" class="table-of-contents__link toc-highlight">代码分析</a></li></ul></li><li><a href="#三fii_gpio模块" class="table-of-contents__link toc-highlight">三、fii_GPIO模块</a><ul><li><a href="#gpio-模块代码" class="table-of-contents__link toc-highlight">gpio 模块代码</a></li><li><a href="#代码分析-2" class="table-of-contents__link toc-highlight">代码分析</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Doongz Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f9aa80d1.js"></script>
<script src="/assets/js/main.0ded408c.js"></script>
</body>
</html>