<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Skill/ASM/RISC-V/EXU模块和CPU运行">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">EXU模块和CPU运行 | Doongz&#x27;s Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doongz.github.io/docs/Skill/ASM/RISC-V/EXU模块和CPU运行"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="EXU模块和CPU运行 | Doongz&#x27;s Site"><meta data-rh="true" name="description" content="一、rv32i_core模块"><meta data-rh="true" property="og:description" content="一、rv32i_core模块"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://doongz.github.io/docs/Skill/ASM/RISC-V/EXU模块和CPU运行"><link data-rh="true" rel="alternate" href="https://doongz.github.io/docs/Skill/ASM/RISC-V/EXU模块和CPU运行" hreflang="en"><link data-rh="true" rel="alternate" href="https://doongz.github.io/docs/Skill/ASM/RISC-V/EXU模块和CPU运行" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Doongz&#39;s Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Doongz&#39;s Site Atom Feed"><link rel="stylesheet" href="/assets/css/styles.99c6e2a1.css">
<link rel="preload" href="/assets/js/runtime~main.f9aa80d1.js" as="script">
<link rel="preload" href="/assets/js/main.0ded408c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Home page</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Notes</a><a class="navbar__item navbar__link" href="/community/support">Community</a><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Courses</a><ul class="dropdown__menu"><li><a href="https://github.com/doongz/mlc-ai" target="_blank" rel="noopener noreferrer" class="dropdown__link">Machine Learning Compilation<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/cs229" target="_blank" rel="noopener noreferrer" class="dropdown__link">Stanford CS229: Machine Learning<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/aics" target="_blank" rel="noopener noreferrer" class="dropdown__link">中国科学院 智能计算系统<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/cs50-ai" target="_blank" rel="noopener noreferrer" class="dropdown__link">Harvard CS50’s Introduction to AI with Python<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/mit-6.824" target="_blank" rel="noopener noreferrer" class="dropdown__link">MIT-6.824 Distributed Systems<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/os-workbench" target="_blank" rel="noopener noreferrer" class="dropdown__link">南京大学 操作系统：设计与实现<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/doongz/mit-6.s081" target="_blank" rel="noopener noreferrer" class="dropdown__link">MIT-6.S081 Operating Systems Engineering<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/doongz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Tutorial Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Algorithm/前述/面试时做题技巧">Algorithm</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Competition/比赛">Competition</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Course/CMU-15-213">Course</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Knowledge/IC/IC">Knowledge</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Math/微积分/极限">Math</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/Skill/ASM/RISC-V/汇编语言格式及ABI">Skill</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/Skill/ASM/RISC-V/汇编语言格式及ABI">ASM</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/Skill/ASM/RISC-V/汇编语言格式及ABI">RISC-V</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/汇编语言格式及ABI">汇编语言格式及ABI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/RISC-V简介">RISC-V 简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/通用寄存器和指令">RISC-V 通用寄存器和指令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/扩展寄存器和指令">RISC-V 扩展寄存器和指令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/流水线&amp;硬件模块&amp;译码模块">流水线 &amp; 硬件模块 &amp; 译码模块</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/ALU模块&amp;branch模块">ALU 模块和 branch 模块</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/LOAD&amp;STORE-UNIT">LSU &amp; SRAM &amp; GPIO模块</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/CSR读写控制">CSR读写控制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Skill/ASM/RISC-V/EXU模块和CPU运行">EXU模块和CPU运行</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/RISC-V总线和流水线">RISC-V 总线和流水线</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/RISC-V定时器及中断">RISC-V 定时器及中断</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/ASM/RISC-V/riscv-asm-manual">RISC-V Assembly Programmer&#x27;s Manual</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/ASM/x86/X86-64汇编">x86</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/Android/Android概述">Android</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/C/基础知识/数据类型">C</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/C++/基础知识/基本数据类型">C++</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/Golang/基础知识/条件判断">Golang</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/Skill/LaTeX/">LaTex</a><button aria-label="Toggle the collapsible sidebar category &#x27;LaTex&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/Linux/POSIX">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/Skill/Markdown/">README</a><button aria-label="Toggle the collapsible sidebar category &#x27;README&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Skill/Mermaid/">mermaid</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/Python/运算符">Python</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/SQL/数据库理论">SQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/工具链/工具&amp;网站">工具链</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/常用CLI/docker-CLI">常用CLI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Skill/设计模式/多态和多态性">设计模式</a></div></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Skill</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">ASM</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">RISC-V</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">EXU模块和CPU运行</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>EXU模块和CPU运行</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一rv32i_core模块">一、rv32i_core模块<a class="hash-link" href="#一rv32i_core模块" title="Direct link to heading">​</a></h2><p><strong>当完成整个RISC-V 内核模块后， 需要ITCM 模块 读取软件编写代码的机器码， 按照取指， 译码，执行，访存，写回等逻辑来执行当前的机器码</strong>， 这5个部分并不是每次都会发送，有时也会提前返回，比如 addi， 没有访存外部存储器。当前版本是RISC-V V2.01版， <strong>使用的是状态机逻辑</strong>， 在后续的版本中， 我们会修改为流水线方式。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="相关代码">相关代码<a class="hash-link" href="#相关代码" title="Direct link to heading">​</a></h3><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module fii_rv32i_core </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [31:0] TMR_BASEADDR  = 32&#x27;h0200_0000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [31:0] PLIC_BASEADDR = 32&#x27;h0c00_0000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [31:0] CPU_BASEADDR  = 32&#x27;h8000_0000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [31:0] MEM_BASEADDR  = 32&#x27;h9000_0000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [31:0] UART_BASEADDR = 32&#x27;he000_0000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [31:0] GPIO_BASEADDR = 32&#x27;hf000_0000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input sys_clk,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//====================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [ 31: 0 ] i_GPIO_dina,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ 31: 0 ] o_GPIO_douta,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ 31: 0 ] o_GPIO_ta,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [ 31: 0 ] i_GPIO_dinb,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ 31: 0 ] o_GPIO_doutb,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ 31: 0 ] o_GPIO_tb,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [ 31: 0 ] i_GPIO_dinc,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ 31: 0 ] o_GPIO_doutc,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ 31: 0 ] o_GPIO_tc,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [ 31: 0 ] i_GPIO_dind,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ 31: 0 ] o_GPIO_doutd,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [ 31: 0 ] o_GPIO_td,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output txd_start,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [7:0] txd_data,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  txd_done,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//====================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [31:0] o_sft_int_v,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [31:0] o_timer_l,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [31:0] o_timer_h,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [31:0] i_timer_l,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [31:0] i_timer_h, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [31:0] o_tcmp_l,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [31:0] o_tcmp_h,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [1:0] o_timer_valid,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [31:0] o_tm_ctrl,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [31:0] code_addr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [31:0] code_din,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  code_wea,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//====================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  i_ext_irq,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  i_sft_irq,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  i_tmr_irq,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output o_meie,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output o_msie,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output o_mtie,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output o_glb_irq,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//====================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  i_cpu_reset,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  rst_n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">localparam [ 2: 0 ] IDLE = 8&#x27;d0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   I_FCH = 8&#x27;d1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   I_EXE = 8&#x27;d2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    I_LS = 8&#x27;d3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    I_WB = 8&#x27;d4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   I_RO1 = 8&#x27;d5,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   I_RO2 = 8&#x27;d6,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   I_RO3 = 8&#x27;d7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire ls_need;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// load program data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(* mark_debug = &quot;yes&quot; *)wire o_CPU_cs;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] o_CPU_PC;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(* mark_debug = &quot;yes&quot; *) reg [ 2: 0 ] instr_st = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg [ 2: 0 ] instr_st_nxt = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always@( posedge sys_clk )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (( rst_n == 1&#x27;b0 ) | i_cpu_reset ) instr_st &lt;= IDLE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else instr_st &lt;= instr_st_nxt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @ ( * )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case ( instr_st )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IDLE: // 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if(!i_cpu_reset)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            instr_st_nxt = I_FCH;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            instr_st_nxt = IDLE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I_FCH: // 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if(i_cpu_reset) instr_st_nxt = IDLE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else instr_st_nxt = I_EXE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I_EXE: // 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if ( ls_need &amp; o_CPU_cs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            instr_st_nxt = I_RO1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            instr_st_nxt = I_WB;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I_WB: // 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        instr_st_nxt = I_FCH;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I_RO1: // 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        instr_st_nxt = I_RO2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I_RO2: // 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        instr_st_nxt = I_FCH;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I_RO3: // 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        instr_st_nxt = I_FCH;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default : instr_st_nxt = IDLE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    endcase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(* mark_debug = &quot;yes&quot; *)reg irq_tch_r = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @ (posedge sys_clk or negedge rst_n)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(~rst_n) irq_tch_r &lt;= 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else if(instr_st == I_FCH) irq_tch_r &lt;= (i_ext_irq | i_sft_irq | i_tmr_irq);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(* mark_debug = &quot;yes&quot; *)wire w_irq_src = o_CPU_cs ? 1&#x27;b0 : irq_tch_r;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(* mark_debug = &quot;yes&quot; *)wire jump_irq_pc = w_irq_src &amp; o_glb_irq;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire w_exp_src = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire irq_exp = w_irq_src | w_exp_src ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire mret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [31:0] mepc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [31:0] w_irq_pc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(* mark_debug = &quot;yes&quot; *) reg [ 31: 0 ] i_fch_PC = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg [ 31: 0 ] res_PC = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [31:0] w_exe_PC;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @( posedge sys_clk or negedge rst_n )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ( !rst_n ) i_fch_PC &lt;= CPU_BASEADDR;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ( instr_st == IDLE ) //0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        i_fch_PC &lt;= CPU_BASEADDR;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else if ( instr_st == I_EXE ) //2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if( mret )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            i_fch_PC &lt;= mepc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else if (jump_irq_pc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            i_fch_PC &lt;= w_irq_pc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else if( o_CPU_cs )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            i_fch_PC &lt;= o_CPU_PC;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            res_PC &lt;= w_exe_PC;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else i_fch_PC &lt;= w_exe_PC;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else if ( instr_st == I_RO1 )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        i_fch_PC &lt;= res_PC;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(* mark_debug = &quot;yes&quot; *) reg EXE_vld = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @( posedge sys_clk or negedge rst_n )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ( !rst_n ) EXE_vld &lt;= 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ( instr_st == I_FCH ) //1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EXE_vld &lt;= 1&#x27;b1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EXE_vld &lt;= 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] instr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(* mark_debug = &quot;yes&quot; *)reg [ 31: 0 ] exe_instr = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @( posedge sys_clk or negedge rst_n )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ( !rst_n ) exe_instr &lt;= 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else if ( instr_st == I_FCH )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exe_instr &lt;= instr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(* mark_debug = &quot;true&quot; *)reg i_CPU_load_vld = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(* mark_debug = &quot;true&quot; *)reg [ 31: 0 ] i_CPU_load_data = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @( posedge sys_clk or negedge rst_n )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ( !rst_n ) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    i_CPU_load_data &lt;= 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    i_CPU_load_vld &lt;= 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else if ( instr_st == I_RO2 )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    i_CPU_load_data &lt;= instr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    i_CPU_load_vld &lt;= 1&#x27;b1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else i_CPU_load_vld &lt;= 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(* mark_debug = &quot;yes&quot; *) wire [ 31: 0 ] instr_PC = i_fch_PC;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rv32I_exu #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .TMR_BASEADDR  ( TMR_BASEADDR ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .PLIC_BASEADDR ( PLIC_BASEADDR ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .CPU_BASEADDR  ( CPU_BASEADDR ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .MEM_BASEADDR  ( MEM_BASEADDR ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .UART_BASEADDR ( UART_BASEADDR ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .GPIO_BASEADDR ( GPIO_BASEADDR )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rv32I_exu_inst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .sys_clk       ( sys_clk ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_ir          ( exe_instr ), // The instruction register</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_PC          ( instr_PC ), // The PC register along with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_EXE_vld     ( EXE_vld ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_CPU_load_vld  ( i_CPU_load_vld),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_CPU_load_data ( i_CPU_load_data ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_ls_need     ( ls_need ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_exe_PC      ( w_exe_PC ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// load program data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_CPU_cs      ( o_CPU_cs ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_CPU_PC      ( o_CPU_PC ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_ext_irq     ( i_ext_irq ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_sft_irq     ( i_sft_irq ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_tmr_irq     ( i_tmr_irq ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_meie        ( o_meie ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_msie        ( o_msie ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_mtie        ( o_mtie ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_glb_irq     ( o_glb_irq ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_irq_src     ( w_irq_src ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_exp_src     ( w_exp_src ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_mret        ( mret ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_irq_pc      ( w_irq_pc ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_mepc        ( mepc ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_GPIO_dina   ( i_GPIO_dina ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_GPIO_douta  ( o_GPIO_douta ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_GPIO_ta     ( o_GPIO_ta ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_GPIO_dinb   ( i_GPIO_dinb ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_GPIO_doutb  ( o_GPIO_doutb ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_GPIO_tb     ( o_GPIO_tb ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_GPIO_dinc   ( i_GPIO_dinc ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_GPIO_doutc  ( o_GPIO_doutc ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_GPIO_tc     ( o_GPIO_tc ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_GPIO_dind   ( i_GPIO_dind ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_GPIO_doutd  ( o_GPIO_doutd ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_GPIO_td     ( o_GPIO_td ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .txd_start     ( txd_start ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .txd_data      ( txd_data ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .txd_done      ( txd_done ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_sft_int_v   ( o_sft_int_v ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_timer_l     ( i_timer_l ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_timer_h     ( i_timer_h ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_timer_l     ( o_timer_l ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_timer_h     ( o_timer_h ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_tcmp_l      ( o_tcmp_l ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_tcmp_h      ( o_tcmp_h ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_timer_valid ( o_timer_valid ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .o_tm_ctrl     ( o_tm_ctrl),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .i_cpu_reset   ( i_cpu_reset),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .rst_n         ( rst_n )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire instr_ena = ( instr_PC[ 31: 16 ] == CPU_BASEADDR[31:16] ) ? 1&#x27;b1 : 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TDP_RAM_INSTR program_inst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .clka  ( sys_clk ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .ena   ( 1&#x27;b1 ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .wea   ( code_wea ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .addra ( code_addr[31:2] ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .dina  ( code_din ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .douta ( ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .clkb  ( sys_clk ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .enb   ( instr_ena ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .web   ( 1&#x27;b0 ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .addrb ( instr_PC[ 31: 2 ] ), //8K 32bits, 32K byte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .dinb  ( 32&#x27;b0 ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .doutb ( instr )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endmodule</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="模块介绍">模块介绍<a class="hash-link" href="#模块介绍" title="Direct link to heading">​</a></h3><p>执行状态机， 使用两段式状态机。 </p><p>在取指状态下锁存 各种中断状态，包括外部中断，软件中断，timer 中断。</p><p>如果上一条指令为普林斯顿架构，需要让这条指令执行完毕， 同时在CSR 寄存器中设置的全局中断enable （o_glb_irq) ， 这时产生的jump_irq_pc 有效。</p><p>在普林斯顿架构下，将load 指令读到的数据 送给 lsu 模块 。</p><p>nstr_ena 选择的时ITCM 地址空间。</p><p>这个双端口为ITCM ：</p><ul><li>端口A ：用户可以通过uart 口，将软件的汇编机器码下载到 ITCM; </li><li>端口B： instr_ena 是选中itcm, instr_PC<!-- -->[31：2]<!-- --> 是当前指令PC。instr 读取ITCM 的指令（如果是普林斯顿架构，也可以读取到的是数据）。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二cpu运行过程基于流水线">二、CPU运行过程（基于流水线）<a class="hash-link" href="#二cpu运行过程基于流水线" title="Direct link to heading">​</a></h2><p>当完成整个RISC-V 内核模块后， 需要ITCM 模块 读取软件编写的代码的机器码， 按照取指， 译码，执行，访存，写回等逻辑来执行当前的机器码， 这5个部分并不是每次都会发送，有时也会提前返回，比如 addi， 没有访存外部存储器。在版本是RISC-V V3.00版和之后的版本中， 使用的是流水线方式来处理cpu 指令。我们采用的是3级流水线方式。 </p><p><img loading="lazy" src="/assets/images/106-0803634f57f40d3a450e9969cd06cf78.jpeg" width="1683" height="880" class="img_ev3q"></p><p>图中蓝色方块都是D触发器锁存。 代表流水线的级别。</p><p><strong>第一级流水线：</strong></p><p>由于我们使用dual port memory 作为ITCM (指令存储器），所以每次给出地址之后， 需要等待一个时钟周期， 然后才能得到相应的指令数据。所以取指的过程需要2个时钟周期。 但这个部分依然属于第一级流水线范畴（取指）。如果使用reg 堆积出来一个ram， 将会节省一个时钟周期， 缺点是占用大量的fpga 系统资源。</p><p><strong>第二级流水线：</strong></p><p>处理整个的译码，执行阶段。包括decoder （译码）， ALU（执行），branch （分支指令执行），CSR （寄存器相关的执行）</p><p><strong>第三级流水线：</strong></p><p>写回 32个通用寄存器（regfile）。如果是LOAD/STORE 相关的指令，处理外设相关的操作。这个部分会被连接到总线上，包括gpio ，timer， Uart, 以及之后risc-v cpu 扩展所需要的外设。</p><p>cpu 取指模块流水线：</p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">`timescale 1ns / 1ps </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module fii_instr_rib </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [31:0] DBG_BASEADDR  = 32&#x27;h0000_0800,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [31:0] TMR_BASEADDR  = 32&#x27;h0200_0000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [31:0] PLIC_BASEADDR = 32&#x27;h0c00_0000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [31:0] CPU_BASEADDR  = 32&#x27;h8000_0000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [31:0] MEM_BASEADDR  = 32&#x27;h9000_0000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [31:0] UART_BASEADDR = 32&#x27;he000_0000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [31:0] PWM_BASEADDR  = 32&#x27;hf000_2000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter [31:0] GPIO_BASEADDR = 32&#x27;hf000_0000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  sys_clk,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output reg [31:0] o_curr_pc,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [31:0]   o_curr_instr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input           i_pc_chg_flag,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input           i_ir_hold_flag,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [31:0]   i_exe_next_PC,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output          o_CPU_load_vld,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  i_ext_irq,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  i_sft_irq,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  i_tmr_irq,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  o_glb_irq,                 // mstatus[3]; enable all Machine Mode interrupt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [31:0] i_dbg_entry_adr,    // jtag debug entry address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  i_dbg_entry_set,           // jtag debug entry address enable ( one clock )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [31:0] i_dpc_r,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [31:0] i_dbg_instr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  dret,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [31:0]  i_mepc,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [31:0]  i_vect_pc,                    // mtvec regitesr content</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output o_irq_src,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output o_exp_src,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  mret,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  dbg_start,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  itcm_wea,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [31:0] itcm_addra,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [31:0] itcm_dina,    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [31:0] i_rib_saddr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [31:0] i_rib_sdin,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [31:0] o_rib_sdout,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  i_rib_svalid,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output [1:0] o_rib_sready,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [3:0]  i_rib_swe,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  i_rib_srd,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  i_rib_sop,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // master bus signal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  i_rib_mvalid,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  [1:0] i_rib_mready,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  i_cpu_reset,    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input  rst_n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// cpu master bus operation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// long instruction : dec_instr should be set as &#x27;INST_NOP, during long instruction.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg  rib_delay_op = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @ ( posedge sys_clk or negedge rst_n)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(!rst_n) rib_delay_op &lt;= 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//else if ( o_rib_mvalid &amp; ~i_rib_mready[0] ) rib_delay_op &lt;= 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else if ( i_rib_mvalid ^ i_rib_mready[0] ) rib_delay_op &lt;= 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else rib_delay_op &lt;= 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire  bus_hsk_ok = i_rib_mvalid &amp; i_rib_mready[0];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// long period load &amp; store operation; normal operation long_ir_flag is 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  wire  long_ir_flag = ( i_rib_mvalid &amp; (~i_rib_mready[0]) ) | rib_delay_op;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// long period instruction pos edge; normal operation long_ir_cs is 0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  wire  long_ir_cs = ( i_rib_mvalid &amp; (~i_rib_mready[0]) ) &amp; i_rib_sop;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  wire o_CPU_load_cs = ( i_rib_saddr[ 31: 16 ] == CPU_BASEADDR[ 31: 16 ] ) ? i_rib_sop : 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls_r is used for 0x8000_0000 DATA load instruction, becasue 0x8000_0000 is dual</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">port ram , it will be delay 2 clock (output data form dual port ram), the ls_r[1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">is signal that o_cpu_load_cs delay 2 clock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg [1:0] ls_r = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @( posedge sys_clk or negedge rst_n)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(!rst_n) ls_r &lt;= 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ls_r &lt;= {ls_r[0], o_CPU_load_cs};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_CPU_load_vld = ls_r[1];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_rib_sready = {1&#x27;b0, ls_r[1]};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [31:0] pc_instr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [31:0]   i_CPU_load_data = pc_instr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 4: 0 ] data_sft = {i_rib_saddr[ 1: 0 ], 3&#x27;b000};  //i_D_PC[ 1: 0 ] * 8;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] o_CPU_dout = i_CPU_load_data &gt;&gt; data_sft;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_rib_sdout = o_CPU_dout;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg [ 31: 0 ] instr_fch_PC = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">next_addr is relevent o_cpu_load_cs, for example : current program pc is 0x8000_0004,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(load instruction ,data at 0x8000_01000), next_addr will be next program pc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x8000_0004 + 4, after load instruction finish. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg [31:0] next_addr = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @( posedge sys_clk )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(!rst_n | i_cpu_reset) next_addr &lt;= CPU_BASEADDR;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else if(i_rib_sop) next_addr &lt;= instr_fch_PC;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_exp_src = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire nop_flag; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// don&#x27;t generate interrupt when cpu load &amp; flush instruction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_irq_src = (long_ir_flag | nop_flag) ? 1&#x27;b0 : (i_ext_irq | i_sft_irq | i_tmr_irq);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire irq_exp_flag = (o_irq_src &amp; o_glb_irq) | o_exp_src ;  // edge o_irq_src high, then o_glb_irq low</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg  [31:0] jump_addr = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @( * )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(i_dbg_entry_set)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jump_addr = i_dbg_entry_adr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else if(dret)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jump_addr = i_dpc_r;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else if (long_ir_cs) // long address &amp; (addr == 0x8000_xxxx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jump_addr = {i_rib_saddr[31:2], 2&#x27;b00};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else if( irq_exp_flag ) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jump_addr = i_vect_pc;    // mtvec regitesr content</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else if( mret )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jump_addr = i_mepc;       // The PC before enter interrupt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else if( i_ir_hold_flag )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jump_addr = o_curr_pc;    // long term instruction ,pc hold at current position</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else jump_addr = i_exe_next_PC;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire w_jump_flag = i_dbg_entry_set | dret | irq_exp_flag | i_pc_chg_flag | mret | long_ir_cs | i_ir_hold_flag;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//stage  1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @( posedge sys_clk )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (( !rst_n ) | i_cpu_reset ) instr_fch_PC &lt;= CPU_BASEADDR;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (w_jump_flag)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        instr_fch_PC &lt;= jump_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else if( ~bus_hsk_ok &amp; rib_delay_op ) // long period load &amp; store </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        instr_fch_PC &lt;= next_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        instr_fch_PC &lt;= instr_fch_PC + 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//stage  2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @( posedge sys_clk or negedge rst_n )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ( !rst_n ) o_curr_pc &lt;= CPU_BASEADDR;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else  o_curr_pc &lt;= i_ir_hold_flag ? o_curr_pc : (bus_hsk_ok &amp; rib_delay_op) ? next_addr : instr_fch_PC;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//else  o_curr_pc &lt;= instr_fch_PC;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> next clock should be output a inst_nop , because dual port ram , address jump, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> the pipeline address (current address + 4) will be ignore, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg waiting_r = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @ (posedge sys_clk or negedge rst_n)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(!rst_n) waiting_r &lt;= 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else  waiting_r &lt;= w_jump_flag;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// w_dbg_pc  point to 0x8000_xxxxx address , we need get data from dual port ram ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// so, w_dbg_pc need 2 clock to get the data(0x8000_xxxx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [31:0] w_dbg_pc = instr_fch_PC;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">localparam [ 31: 0 ] DBG_RAM_ADDR    = 32&#x27;h0000_0400;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 0x400 - 0x800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire dbg_addr_sel = (w_dbg_pc[31:12] ==  DBG_BASEADDR[31:12]) &amp; (w_dbg_pc[11:10] !=  2&#x27;b00) ? 1&#x27;b1 : 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg dbg_addr_cs = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @ (posedge sys_clk or negedge rst_n)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(!rst_n) dbg_addr_cs &lt;= 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else    dbg_addr_cs &lt;= dbg_addr_sel;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [31:0] instr_data_sel = dbg_addr_cs ? i_dbg_instr : pc_instr ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_curr_instr = (waiting_r) ? `INST_NOP : instr_data_sel;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign nop_flag = (o_curr_instr == `INST_NOP) ? 1&#x27;b1 : 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire instr_ena = ( instr_fch_PC[ 31: 16 ] == CPU_BASEADDR[31:16] ) ? 1&#x27;b1 : 1&#x27;b0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TDP_RAM_INSTR  program_inst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .clka   ( sys_clk ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .ena    ( 1&#x27;b1 ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .wea    ( itcm_wea ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .addra  ( itcm_addra[31:2] ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .dina   ( itcm_dina ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .douta  ( ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .clkb   ( sys_clk ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .enb    ( instr_ena ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .web    ( 1&#x27;b0 ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .addrb  ( instr_fch_PC[ 31: 2 ] ), //8K 32bits, 32K byte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .dinb   ( 32&#x27;b0 ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .doutb  ( pc_instr )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endmodule</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="代码分析">代码分析<a class="hash-link" href="#代码分析" title="Direct link to heading">​</a></h3><p><strong>端口说明：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">input sys_clk,                              // 系统时钟</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output reg [31:0] o_curr_pc,             // 输出 当前的PC 值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output       [31:0] o_curr_instr,          // 输出 当前的 指令值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//=======================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_pc_chg_flag,               // 译码，执行模块通知 pc 值需要更改，不再是正常的 + 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_ir_hold_flag,                // 处理乘除法指令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [31:0] i_exe_next_PC, // 译码，执行模块通知 下一个pc 值 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output o_CPU_load_vld,        // 普林斯顿架构 itcm 提供的数据有效</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//=======================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_ext_irq,                        // 外部中断</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_sft_irq,                         // 软件中断</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_tmr_irq,                       // timer中断 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input o_glb_irq,                       // CSR 全局中断位，mstatus[3]; enable all Machine Mode interrupt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [31:0] i_dbg_entry_adr, // jtag 调试入口地址，jtag debug entry address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_dbg_entry_set,           // jtag 调试入口 enable， jtag debug entry address enable ( one clock )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [31:0] w_dpc_r,             // jtag 调试 pc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [31:0] w_dbg_instr,      // jtag 调试 指令 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input dret,                                  // jtag 调试中断 返回</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [31:0] i_mepc,                // 中断时，存储的当前pc 值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [31:0] i_vect_pc,           // 中断时， 跳入中断的pc 值，mtvec regitesr content</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output o_irq_src,                   // 通知 CSR 模块 中断信号线</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output o_exp_src,                  // 通知 CSR 模块 异常信号线</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input mret,                                // 中断返回 信号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input dbg_start,                       // 进入jtag 调试 信号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//=======================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input itcm_wea,                      // ITCM 更新 写 enable </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [31:0] itcm_addra,      // ITCM 更新 地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [31:0] itcm_dina,        // ITCM 更新 数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//=======================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// riscv 内部总线 slave 总线</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [31:0] i_rib_saddr,    // riscv 内部总线 地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [31:0] i_rib_sdin,      // riscv 内部总线 写数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [31:0] o_rib_sdout,// riscv 内部总线 读数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_rib_svalid,               // riscv 内部总线 指令有效</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output [1:0] o_rib_sready, // riscv 内部总线 ，外设读取的数据有效</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [3:0] i_rib_swe,        // riscv 内部总线 写 enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_rib_srd,                    // riscv 内部总线 读 信号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_rib_sop,                  // riscv 内部总线 指令操作 enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//=======================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// riscv 内部总线 master 总线，master bus signal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input i_rib_mvalid,           // riscv 内部总线指令有效</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input [1:0] i_rib_mready,// riscv 内部总线，外部读取的数据有效</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//=======================================================================</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>长周期指令操作：</strong></p><p>在长周期的操作时，需要插入空指令，保持流水线连续。</p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// cpu master bus operation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// long instruction : dec_instr should be set as ‘INST_NOP, during long instruction.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg rib_delay_op = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @ ( posedge sys_clk or negedge rst_n)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(!rst_n) rib_delay_op &lt;= 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else if ( i_rib_mvalid ^ i_rib_mready[0] ) rib_delay_op &lt;= 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else rib_delay_op &lt;= 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire bus_hsk_ok = i_rib_mvalid &amp; i_rib_mready[0];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// long period load &amp; store operation; normal operation long_ir_flag is 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire long_ir_flag = ( i_rib_mvalid &amp; (~i_rib_mready[0]) ) | rib_delay_op;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// long period instruction pos edge; normal operation long_ir_cs is 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire long_ir_cs = ( i_rib_mvalid &amp; (~i_rib_mready[0]) ) &amp; i_rib_sop;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>长周期指令，包括普林斯顿结构数据读取， jtag 相关指令。</p><p><img loading="lazy" alt="107" src="/assets/images/107-8002fcc8495a84978f505e83e19ce8bc.jpeg" width="1824" height="664" class="img_ev3q"></p><p><strong>普林斯顿架构下， 读取的数据延迟：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reg [1:0] ls_r = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @( posedge sys_clk or negedge rst_n)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(!rst_n) ls_r &lt;= 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls_r &lt;= {ls_r[0], o_CPU_load_cs};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_CPU_load_vld = ls_r[1];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_rib_sready = {1’b0, ls_r[1]};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>由于使用的时双端口 memory， 需要延迟一个时钟周期，配合总线一起使用。</p><p><strong>lb,lw,lh等load 指令的相关处理：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 4: 0 ] data_sft = {i_rib_saddr[ 1: 0 ], 3’b000}; //i_D_PC[ 1: 0 ] * 8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire [ 31: 0 ] o_CPU_dout = i_CPU_load_data &gt;&gt; data_sft;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_rib_sdout = o_CPU_dout;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>普林斯顿架构下，保存当前pc操作：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reg [31:0] next_addr = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @( posedge sys_clk )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(!rst_n | i_cpu_reset) next_addr &lt;= CPU_BASEADDR;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else if(i_rib_sop) next_addr &lt;= instr_fch_PC;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>中断源处理：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">assign o_exp_src = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire nop_flag;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// don’t generate interrupt when cpu load &amp; flush instruction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_irq_src = (long_ir_flag | nop_flag) ? 1’b0 : (i_ext_irq | i_sft_irq | i_tmr_irq);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wire irq_exp_flag = (o_irq_src &amp; o_glb_irq) | o_exp_src ; // edge w_irq_src high, then o_glb_irq low</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>长周期指令， 空指令等需要等待， 其他情况时，触发中断。</p><p><strong>各种情况下的的pc 跳转：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reg [31:0] jump_addr = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @( * )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(i_dbg_entry_set)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jump_addr = i_dbg_entry_adr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else if(dret)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jump_addr = i_dpc_r;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else if (long_ir_cs)               // long address &amp; (addr == 0x8000_xxxx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jump_addr = {i_rib_saddr[31:2], 2’b00};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else if( irq_exp_flag )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jump_addr = i_vect_pc; // mtvec regitesr content</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else if( mret )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jump_addr = i_mepc;      // The PC before enter interrupt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else if( i_ir_hold_flag )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jump_addr = o_curr_pc; // long term instruction ,pc hold at current position</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else jump_addr = i_exe_next_PC;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>准备跳转的pc：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wire w_jump_flag = i_dbg_entry_set | dret | irq_exp_flag | i_pc_chg_flag | mret | long_ir_cs | i_ir_hold_flag;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @( posedge sys_clk )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (( !rst_n ) | i_cpu_reset ) instr_fch_PC &lt;= CPU_BASEADDR;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     if (w_jump_flag)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         instr_fch_PC &lt;= jump_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     else if( ~bus_hsk_ok &amp; rib_delay_op ) // long period load &amp; store</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         instr_fch_PC &lt;= next_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         instr_fch_PC &lt;= instr_fch_PC + 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>实际要跳转的pc：</strong></p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">always @( posedge sys_clk or negedge rst_n )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ( !rst_n ) o_curr_pc &lt;= CPU_BASEADDR;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else o_curr_pc &lt;= i_ir_hold_flag ? o_curr_pc : (bus_hsk_ok &amp; rib_delay_op) ? next_addr : instr_fch_PC;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>空指令enable 信号：</strong></p><p>当发生跳转时（不是正常的pc + 4），需要插入空指令，保持流水线连续， </p><div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reg waiting_r = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">always @ (posedge sys_clk or negedge rst_n)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(!rst_n) waiting_r &lt;= 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else waiting_r &lt;= w_jump_flag;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assign o_curr_instr = (waiting_r) ? `INST_NOP : instr_data_sel;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/assets/images/108-e782648c99aeb269eaab65be7b3cbda2.jpeg" width="695" height="177" class="img_ev3q"></p><p><img loading="lazy" src="/assets/images/109-ec3455a8b79741b0c61ada06b08155a6.jpeg" width="1082" height="276" class="img_ev3q"></p><p>流水线操作要比状态机操作复杂一些， 尤其时增加了jtag 的调式功能之后。这个部分可以参考以上的代码， 同时仿真整个risc-v 的工程，帮助了解流水线操作的相关cpu 运作。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Skill/ASM/RISC-V/CSR读写控制"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">CSR读写控制</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Skill/ASM/RISC-V/RISC-V总线和流水线"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">RISC-V 总线和流水线</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一rv32i_core模块" class="table-of-contents__link toc-highlight">一、rv32i_core模块</a><ul><li><a href="#相关代码" class="table-of-contents__link toc-highlight">相关代码</a></li><li><a href="#模块介绍" class="table-of-contents__link toc-highlight">模块介绍</a></li></ul></li><li><a href="#二cpu运行过程基于流水线" class="table-of-contents__link toc-highlight">二、CPU运行过程（基于流水线）</a><ul><li><a href="#代码分析" class="table-of-contents__link toc-highlight">代码分析</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Doongz Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f9aa80d1.js"></script>
<script src="/assets/js/main.0ded408c.js"></script>
</body>
</html>