# Vim

参考：[精通 VIM ，此文就够了](https://zhuanlan.zhihu.com/p/68111471)

![vim](./doc/vim.png)

## 一、配置文件

vim ~/.vimrc

```shell
syntax on	    " 自动语法高亮
set number      " 显示行号
set cindent
set smartindent " 开启新行时使用智能自动缩进
set showmatch   " 插入括号时，短暂地跳转到匹配的对应括号
set ruler       " 打开状态栏标尺
set mouse=a     "在vim所有模式下开鼠标，复制文档就可以不包含行号了

if has("autocmd") " 重新打开光标调到上次退出的地方
  au BufReadPost * if line("'\"") > 1 && line("'\"") <= line("$") | exe "normal! g'\"" | endif
endif

set ts=4        " tab 为4个空格
set expandtab    " 换行保持当前缩进
set autoindent

set hlsearch        " 查找结果 高亮显示
colorscheme desert  " 配色方案
```

## 二、快捷键

### 查找

1. f：行内向后查找，如在一行内查找字母 ‘t’，则是ft，光标移动到下一个字母‘t’处；分号;重复这一查找动作，继续向后查找，相反的，逗号,重复查找动作，但向前；
2. F：行内向前查找；类比于f，与f的行为相反；
3. 全文查找：/；用法是按下正斜线/，进入命令行模式，输入待查找的字符，然后回车，光标即可移动到匹配处；n（即next的缩写）移动到下一个匹配处，N移动到上一个匹配处。

### 删除

| 快捷键  | 说明                                                         |
| ------- | ------------------------------------------------------------ |
| gg dG   | 清空                                                         |
| dd      | 删行                                                         |
| ndd     | 删除光标处开始的 n 行                                        |
| dw      | 删除一个单词                                                 |
| dnw     | 删除 n 个单词，                                              |
| `d$`    | 删除光标到本行的结尾                                         |
| `dG`    | 删除屏幕显示的第一行文本到光标所在的行                       |
| `dH`    | 删除屏幕显示的第一行文本到光标所在的行                       |
| s       | 删除光标所在处的字符然后插入需要录入的文本                   |
| S       | 删除光标所在行，在当前行的行首开始插入需要录入的文本         |
| cw      | 删除从光标处开始到该单词结束的所有字符，然后插入需要录入的文本 |
| :n1,n2d | n1 和 n2 指的是起始行号和结束行号，d 是删除关键字            |
| x       | 删除光标当前所在的字符                                       |
| r       | 替换掉光标当前所在的字符                                     |
| R       | 替换掉从光标开始以后的所有字符，除非 `<ESC >` 退出           |

### 复制和粘贴

1. 将光标移动到要复制的文本开始的地方，按v进入可视模式。
2. 将光标移动到要复制的文本的结束的地方，按y复制。此时vim会自动将光标定位到选中文本的开始的地方，并退出可视模式。
3. 移动光标到文本结束的地方，按p粘贴。

| 命令 | 说明                                 |
| ---- | ------------------------------------ |
| yw   | 复制一个单词，还有 `ynw`             |
| yfa  | 复制光标到下一个 a 的字符处,还有ynfa |
| yy   | 复制一行，还有 nyy                   |
| y$   | 复制光标到本号的结尾                 |
| yH   | 制屏幕显示的第一行文本到光标所在的行 |
| yG   | 复制光标所在行到文本的结束           |
|      |                                      |
| p    | 在光标后开始黏贴                     |
| P    | 大写的 P 光标前开始粘贴              |
|      |                                      |

### 撤销

| 命令   | 说明                   |
| ------ | ---------------------- |
| u      | 撤销上一步的操作       |
| Ctrl+r | 恢复上一步被撤销的操作 |



### 多行注释

1. 进入vi/vim编辑器，按CTRL+V进入可视化模式（VISUAL BLOCK）

2. 移动光标上移或者下移，选中多行的开头，如下图所示

3. 选择完毕后，按大写的的I键，此时下方会提示进入“insert”模式，输入你要插入的注释符，例如#

4. 最后按ESC键，你就会发现多行代码已经被注释了

5. 删除多行注释的方法，同样 Ctrl+v 进入列选择模式，移到光标把注释符选中，按下d，注释就被删除了。

### 文本的替换

| 命令                                      | 说明                                                         |
| ----------------------------------------- | ------------------------------------------------------------ |
| `:{作用范围}s/{目标}/{替换}/{替换的标志}` | 作用范围分为当前行、全文、选区等等。                         |
| `:s/zempty/handsome/g`                    | 将会把当前光标所在行的 zempty 替换成 handsome                |
| `:%s/zempty/handsome/g`                   | 将会把全文中的 zempty 替换成 handsome                        |
| `:n1,n2s/zempty/handsome/g`               | 这里的 n1 和 n2 值得是行号，将会替换掉 n1 到 n2 的所有 zempty 为 handsome. |

### VIM 执行 Linux 命令

```
:!command
:!command && command
```

`:` 后面紧跟着 `!` ，`!` 后面紧跟着 linux 命令（ command 指操作 Linux 系统的一系列命令，如创建文件，新建文件夹，查询文件的属性的等），例子如下，

```
:!date
```

执行 date 命令显示时间，执行完命令以后按下键盘上的 Enter 就会返回到文件。

**VIM 执行命令，并且添加结果至操作文本光标处**

```
:r !command
```

: 后面紧跟着 r , r 后面是空格，紧接着是 !command( command 解释同上)，例子如下，

```
:r !date
```

执行 date 命令显示时间，并且添加命令结果到文本中



```
:%! command
```

如 `:%!grep execve` 对 vim 的 buffer 执行命令行，然后替换 buffer

### 可视化模式下 v 的特殊操作

当操作的文本光标在 “”，‘’ ，（），{} ，[（双引号，单引号，小括号，大括号，中括号）
当中的时候,可以通过 va"选中 ”“ 内的所有内容包括双引号 ，vi" 选中 "" 内的所有内容，不包括 ""。va,vi 会快速选择区域，va 后面会紧跟一个区域结束标志，a 会选中结束符标志，i 就不会。例子如下：

"hello world [VI**M** is so strong],{we all can master vim skill}"

假设当前光标定位在上面的文本 M 处：

va] 操作将会选中以下文本（加粗部分）：

“hello world***[VIM is so strong]***,{we all can master vim skill}“

vi] 操作将会选中如下的区域，没有包含 []：

“hello world [***VIM is so strong\***],{we all can master vim skill}“

### 输出管道给 vim 实例

```bash
$ strace -T ./a.out |& vim -
```

- 编辑器里还可以 `%!grep` (细节/技巧)，如 `:%! grep execve` 对 vim 的 buffer 执行命令行，然后替换 buffer
- `:set nowrap`，设置不自动换行，只看到几个 `execve`
- `:%! grep -v ENOENT `，将不想看到的行删掉
- `:%s/, /\r /g`，把逗号+空格，换成换行符

## 三、光标移动

简单移动：`h,j,k,l`这四个字母移动效果和方向键一样，只不过离手指更近，用起来更方便。其中 `j` 和
`k` 分别表示向下和向上移动；`h ,l` 表示左右移动。这几个字母都可以和数字键组合，如`5j`，表示向下移动5行。这种组合的逻辑也是通用的，下文能看到。

双击 jj ，一直按着 j

### 行内移动

| 命令       | 说明                                                         |
| ---------- | ------------------------------------------------------------ |
| $          | 移动到行末                                                   |
| ^ 或数字 0 | 移动到句首                                                   |
| w          | 移到下个单词的首字，`5w`则是向后移动5个单词                  |
| e          | 光标移动到下一个单词的结尾                                   |
| b          | 移动到上一个单词的首字母                                     |
| fa         | 移动到本行下一个为 a 的字符处，fb 移动到下一个为 b 的字符处  |
| nfa        | 移动到本行光标处开始的第 n 个 字符为 a 的地方（n 是 1，2，3，4 ... 数字） |
| Fa         | `Fa` 同 `fa` 一样，光标移动方向同 `fa` 相反                  |
| nFa        | `nFa` 同 `nfa` 类似，光标移动方向同 `nfa`相反                |

`;` 和`,` 当使用 f, F, t ,T, 关键字指定字符跳转的时候，使用 `；`可以快速跳转到写一个指定的字符，`,` 是跳到前一个指定的字符（fo 寻找到下一个o之后，按下；会快速跳转到下一个o）

### 全文移动

| 命令    | 说明                                                         |
| ------- | ------------------------------------------------------------ |
| nG  ngg | 光标定位到第 n 行的行首，数字+gg，如 10gg，则移动到第十行    |
| gg      | 光标定位到第一行的行首                                       |
| G       | 光标定位到最后一行的行首                                     |
| G + $   | 最后一行的行尾                                               |
| H       | 光标定位到当前屏幕的第一行行首                               |
| M       | 光标移动到当前屏幕的中间                                     |
| L       | 光标移动到当前屏幕的尾部                                     |
| zt      | 把当前行移动到当前屏幕的最上方，也就是第一行                 |
| zz      | 把当前行移动到当前屏幕的中间                                 |
| zb      | 把当前行移动到当前屏幕的尾部                                 |
| %       | 匹配括号移动，包括 ( , { , [ 需要把光标先移动到括号上        |
| *  和 # | 匹配光标当前所在的单词，移动光标到下一个（或者上一个）匹配的单词（ `*` 是下一个，`#` 是上一个） |
| ctrl+f  | 向下翻页                                                     |
| ctrl+b  | 向上翻页                                                     |
| ctrl+e  | 屏幕上移                                                     |
| ctrl+y  | 屏幕下移                                                     |

## 四、输入模式

### 进入插入模式

| 命令 | 说明                                                         |
| ---- | ------------------------------------------------------------ |
| i    | 在光标所在的字符之前插入需要录入的文本。                     |
| I    | 在光标所在行的行首插入需要录入的文本。                       |
| a    | 在光标所在的字符之后插入需要录入的文本。                     |
| A    | 在光标所在行的行尾插入需要录入的文本。                       |
| o    | 光标所在行的下一行行首插入需要录入的文本。                   |
| O    | 光标所在行的上一行行首插入需要录入的文本。                   |
| s    | 删除光标所在处的字符然后插入需要录入的文本                   |
| S    | 删除光标所在行，在当前行的行首开始插入需要录入的文本         |
| cw   | 删除从光标处开始到该单词结束的所有字符，然后插入需要录入的文本 |

## 五、命令模式

| 快捷键       | 说明                                            |
| ------------ | ----------------------------------------------- |
| :set nu      | 显示行数                                        |
| :set nonu    | 会取消行号                                      |
| :n           | 定位到 n 行                                     |
| /<查找内容>  | 查找，回车，n下一个                             |
| :set ic      | 不会区分大小写,影响查询                         |
| :set noic    | 用来区分大小写的查询。                          |
| :set paste   | 解决粘贴后，换行乱问题；恢复命令   :set nopaste |
| :set mouse=r | 虚拟远程终端在vi界面开启鼠标支持复制,=a关闭     |
| :set nowrap  | 查看文件时让其不自动换行                        |
| :%s/, /\r /g | 把逗号+空格，换成换行符                         |

## 六、退出

| 命令         | 说明                                                         |
| ------------ | ------------------------------------------------------------ |
| :w           | 保存当前对文件的修改，但是不退出文件。                       |
| :w!          | 强制保存但是不退出文件。                                     |
| :w file      | 保存当前的文件修改到 file 文件当中。                         |
| :q!          | 退出文件，对文件的修改不做保存。                             |
| :qa!         | 退出所有的文件，对所有的文件修改都不做保存。                 |
| :wq          | 退出文件并保存对文件的修改。                                 |
| :x           | 退出文件并保存对文件的修改。                                 |
| :e file      | 打开另一个文件。                                             |
| :e!          | 放弃对文件的所有修改，恢复文件到上次保存的位置。             |
| :saveas file | 另存为 file。                                                |
| :bn 和 :bp   | 当打开多个文件的时候可以输入 `:bn` 和 `:bp` 进行上一个文件或者下一个文件的切换。 |

## 七、vimdiff

```
vimdiff file1 file2
vim -d file1 file2
```

## 八、查看、编辑二进制文件

### step1：使用vim打开二进制文件

```shell
vim -b 文件
```

### step2：将内容转化为16进制

想要修改二进制文件内容，需要将文件修改为16进制以后再进行修改。命令如下：

也可以指定每行显示的字节数，默认是每行显示16个字节。例如：每行显示12个字节

```
:%!xxd
:%!xxd -c 12
```

### step3：将当前文本转化回文本格式

```
:%!xxd -r
```

注意：修改完文件内容以后，一定要将文件内容转回文本格式，否则二进制文件可能无法使用。不过就算忘记转化回文本格式就保存退出了，再进来重新转化一次也可以。

### step4：保存退出

```
:wq
```

