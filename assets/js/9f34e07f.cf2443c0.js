"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[66746],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var i=r.createContext({}),s=function(e){var n=r.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=s(e.components);return r.createElement(i.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,l=e.originalType,i=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),d=s(t),m=a,k=d["".concat(i,".").concat(m)]||d[m]||u[m]||l;return t?r.createElement(k,o(o({ref:n},c),{},{components:t})):r.createElement(k,o({ref:n},c))}));function k(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=t.length,o=new Array(l);o[0]=m;var p={};for(var i in n)hasOwnProperty.call(n,i)&&(p[i]=n[i]);p.originalType=e,p[d]="string"==typeof e?e:a,o[1]=p;for(var s=2;s<l;s++)o[s]=t[s];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},17204:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>p,toc:()=>s});var r=t(87462),a=(t(67294),t(3905));const l={},o="\u8be6\u89e3 Kubernetes ReplicaSet \u7684\u5b9e\u73b0\u539f\u7406",p={unversionedId:"Knowledge/\u5bb9\u5668\u6280\u672f/kubernetes\u5bf9\u8c61\u8be6\u89e3/replicaSet",id:"Knowledge/\u5bb9\u5668\u6280\u672f/kubernetes\u5bf9\u8c61\u8be6\u89e3/replicaSet",title:"\u8be6\u89e3 Kubernetes ReplicaSet \u7684\u5b9e\u73b0\u539f\u7406",description:"\u6765\u6e90\uff1a\u8be6\u89e3 Kubernetes ReplicaSet \u7684\u5b9e\u73b0\u539f\u7406",source:"@site/docs/Knowledge/05-\u5bb9\u5668\u6280\u672f/kubernetes\u5bf9\u8c61\u8be6\u89e3/4-replicaSet.md",sourceDirName:"Knowledge/05-\u5bb9\u5668\u6280\u672f/kubernetes\u5bf9\u8c61\u8be6\u89e3",slug:"/Knowledge/\u5bb9\u5668\u6280\u672f/kubernetes\u5bf9\u8c61\u8be6\u89e3/replicaSet",permalink:"/docs/Knowledge/\u5bb9\u5668\u6280\u672f/kubernetes\u5bf9\u8c61\u8be6\u89e3/replicaSet",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"docsSidebar",previous:{title:"\u8be6\u89e3 Kubernetes Volume \u7684\u5b9e\u73b0\u539f\u7406",permalink:"/docs/Knowledge/\u5bb9\u5668\u6280\u672f/kubernetes\u5bf9\u8c61\u8be6\u89e3/volume"},next:{title:"\u8be6\u89e3 Kubernetes \u5783\u573e\u6536\u96c6\u5668\u7684\u5b9e\u73b0\u539f\u7406",permalink:"/docs/Knowledge/\u5bb9\u5668\u6280\u672f/kubernetes\u5bf9\u8c61\u8be6\u89e3/garbage-collector"}},i={},s=[{value:"\u4e00\u3001\u6982\u8ff0",id:"\u4e00\u6982\u8ff0",level:2},{value:"\u4e8c\u3001\u5b9e\u73b0\u539f\u7406",id:"\u4e8c\u5b9e\u73b0\u539f\u7406",level:2},{value:"1\u3001\u540c\u6b65",id:"1\u540c\u6b65",level:3},{value:"2\u3001\u5220\u9664",id:"2\u5220\u9664",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2},{value:"Reference",id:"reference",level:2}],c={toc:s};function d(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u8be6\u89e3-kubernetes-replicaset-\u7684\u5b9e\u73b0\u539f\u7406"},"\u8be6\u89e3 Kubernetes ReplicaSet \u7684\u5b9e\u73b0\u539f\u7406"),(0,a.kt)("p",null,"\u6765\u6e90\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://draveness.me/kubernetes-replicaset/"},"\u8be6\u89e3 Kubernetes ReplicaSet \u7684\u5b9e\u73b0\u539f\u7406")),(0,a.kt)("p",null,"Kubernetes \u4e2d\u7684 ReplicaSet \u4e3b\u8981\u7684\u4f5c\u7528\u662f\u7ef4\u6301\u4e00\u7ec4 ",(0,a.kt)("a",{parentName:"p",href:"https://draveness.me/kubernetes-pod"},"Pod")," \u526f\u672c\u7684\u8fd0\u884c\uff0c\u5b83\u7684\u4e3b\u8981\u4f5c\u7528\u5c31\u662f\u4fdd\u8bc1\u4e00\u5b9a\u6570\u91cf\u7684 Pod \u80fd\u591f\u5728\u96c6\u7fa4\u4e2d\u6b63\u5e38\u8fd0\u884c\uff0c\u5b83\u4f1a\u6301\u7eed\u76d1\u542c\u8fd9\u4e9b Pod \u7684\u8fd0\u884c\u72b6\u6001\uff0c\u5728 Pod \u53d1\u751f\u6545\u969c\u91cd\u542f\u6570\u91cf\u51cf\u5c11\u65f6\u91cd\u65b0\u8fd0\u884c\u65b0\u7684 Pod \u526f\u672c\u3002"),(0,a.kt)("p",null,"\u8fd9\u7bc7\u6587\u7ae0\u4f1a\u4ecb\u7ecd ReplicaSet \u7684\u5de5\u4f5c\u539f\u7406\uff0c\u5176\u4e2d\u5305\u62ec\u5728 Kubernetes \u4e2d\u662f\u5982\u4f55\u88ab\u521b\u5efa\u7684\u3001\u5982\u4f55\u521b\u5efa\u5e76\u6301\u6709 Pod \u5e76\u5728\u51fa\u73b0\u95ee\u9898\u65f6\u91cd\u542f\u5b83\u4eec\u3002"),(0,a.kt)("h2",{id:"\u4e00\u6982\u8ff0"},"\u4e00\u3001\u6982\u8ff0"),(0,a.kt)("p",null,"\u5728\u5177\u4f53\u4ecb\u7ecd ReplicaSet \u7684\u5b9e\u73b0\u539f\u7406\u4e4b\u524d\uff0c\u6211\u4eec\u8fd8\u662f\u4f1a\u5148\u7b80\u5355\u4ecb\u7ecd\u5b83\u7684\u4f7f\u7528\uff0c\u4e0e\u5176\u4ed6\u7684 Kubernetes \u5bf9\u8c61\u4e00\u6837\uff0c\u6211\u4eec\u4f1a\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u4f7f\u7528 YAML \u6587\u4ef6\u521b\u5efa\u65b0\u7684 ReplicaSet \u5bf9\u8c61\uff0c\u4e00\u4e2a\u5e38\u89c1\u7684 ReplicaSet \u7684\u5b9a\u4e49\u5176\u5b9e\u662f\u8fd9\u6837\u7684\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps/v1\nkind: ReplicaSet\nmetadata:\n  name: frontend\n  labels:\n    app: guestbook\n    tier: frontend\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      tier: frontend\n  template:\n    metadata:\n      labels:\n        tier: frontend\n    spec:\n      containers:\n      - name: php-redis\n        image: gcr.io/google_samples/gb-frontend:v3\n")),(0,a.kt)("p",null,"\u8fd9\u91cc\u7684 YAML \u6587\u4ef6\u9664\u4e86\u5e38\u89c1\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"apiVersion"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"kind")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"metadata")," \u5c5e\u6027\u4e4b\u5916\uff0c\u89c4\u683c\u4e2d\u603b\u5171\u5305\u542b\u4e09\u90e8\u5206\u91cd\u8981\u5185\u5bb9\uff0c\u4e5f\u5c31\u662f Pod \u526f\u672c\u6570\u76ee ",(0,a.kt)("inlineCode",{parentName:"p"},"replicas"),"\u3001\u9009\u62e9\u5668 ",(0,a.kt)("inlineCode",{parentName:"p"},"selector")," \u548c Pod \u6a21\u677f ",(0,a.kt)("inlineCode",{parentName:"p"},"template"),"\uff0c\u8fd9\u4e09\u4e2a\u90e8\u5206\u5171\u540c\u5b9a\u4e49\u4e86 ReplicaSet \u7684\u89c4\u683c\uff1a"),(0,a.kt)("p",null,"\u540c\u4e00\u4e2a ReplicaSet \u4f1a\u4f7f\u7528\u9009\u62e9\u5668 ",(0,a.kt)("inlineCode",{parentName:"p"},"selector")," \u4e2d\u7684\u5b9a\u4e49\u67e5\u627e\u96c6\u7fa4\u4e2d\u81ea\u5df1\u6301\u6709\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Pod"),"\u5bf9\u8c61\uff0c\u5b83\u4eec\u4f1a\u6839\u636e\u6807\u7b7e\u7684\u5339\u914d\u83b7\u53d6\u80fd\u591f\u83b7\u5f97\u7684 Pod\uff0c\u4e0b\u9762\u5c31\u662f\u6301\u6709\u4e09\u4e2a Pod \u5bf9\u8c61\u7684 Replica \u62d3\u6251\u56fe\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-mermaid"},"graph TD\n    ReplicaSet-.->Pod1\n    ReplicaSet-.->Pod2\n    ReplicaSet-.->Pod3\n")),(0,a.kt)("p",null,"\u88ab ReplicaSet \u6301\u6709\u7684 Pod \u6709\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"metadata.ownerReferences")," \u6307\u9488\u6307\u5411\u5f53\u524d\u7684 ReplicaSet\uff0c\u8868\u793a\u5f53\u524d Pod \u7684\u6240\u6709\u8005\uff0c\u8fd9\u4e2a\u5f15\u7528\u4e3b\u8981\u4f1a\u88ab\u96c6\u7fa4\u4e2d\u7684 ",(0,a.kt)("a",{parentName:"p",href:"https://draveness.me/kubernetes-garbage-collector"},"\u5783\u573e\u6536\u96c6\u5668"),"\u4f7f\u7528\u4ee5\u6e05\u7406\u5931\u53bb\u6240\u6709\u8005\u7684 Pod \u5bf9\u8c61\u3002"),(0,a.kt)("h2",{id:"\u4e8c\u5b9e\u73b0\u539f\u7406"},"\u4e8c\u3001\u5b9e\u73b0\u539f\u7406"),(0,a.kt)("p",null,"\u6240\u6709 ReplicaSet \u5bf9\u8c61\u7684\u589e\u5220\u6539\u67e5\u90fd\u662f\u7531 ",(0,a.kt)("inlineCode",{parentName:"p"},"ReplicaSetController")," \u63a7\u5236\u5668\u5b8c\u6210\u7684\uff0c\u8be5\u63a7\u5236\u5668\u4f1a\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"p"},"Informer")," \u76d1\u542c ReplicaSet \u548c Pod \u7684\u53d8\u66f4\u4e8b\u4ef6\u5e76\u5c06\u5176\u52a0\u5165\u6301\u6709\u7684\u5f85\u5904\u7406\u961f\u5217:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-mermaid"},"graph TD\n    PI[PodInformer]-. Event .->RSC[ReplicaSetController]\n    RSI[ReplicaSetInformer]-. Event .->RSC\n    RSC--\x3eworker1\n    RSC-. Add ReplicaSet .->queue\n    worker1-. Loop .->worker1\n    queue-. Get ReplicaSet .->worker1\n    RSC--\x3eworker2\n    worker2-. Loop .->worker2\n    queue-. Get ReplicaSet .->worker2\n    style worker1 fill:#fffede,stroke:#ebebb7\n    style worker2 fill:#fffede,stroke:#ebebb7\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"ReplicaSetController")," \u4e2d\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"queue")," \u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u5b58\u50a8\u5f85\u5904\u7406 ReplicaSet \u7684\u300e\u5bf9\u8c61\u6c60\u300f\uff0c\u5b83\u8fd0\u884c\u7684\u51e0\u4e2a Goroutine \u4f1a\u4ece\u961f\u5217\u4e2d\u53d6\u51fa\u6700\u65b0\u7684\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u4e0a\u56fe\u5c55\u793a\u4e86\u4e8b\u4ef6\u4ece\u53d1\u751f\u5230\u88ab\u5904\u7406\u7684\u6d41\u5411\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u5c06\u5206\u522b\u4ecb\u7ecd ReplicaSet \u4e2d\u5e38\u89c1\u7684\u540c\u6b65\u8fc7\u7a0b\u3002"),(0,a.kt)("h3",{id:"1\u540c\u6b65"},"1\u3001\u540c\u6b65"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"ReplicaSetController")," \u542f\u52a8\u7684\u591a\u4e2a Goroutine \u4f1a\u4ece\u961f\u5217\u4e2d\u53d6\u51fa\u5f85\u5904\u7406\u7684\u4efb\u52a1\uff0c\u7136\u540e\u8c03\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"syncReplicaSet")," \u8fdb\u884c\u540c\u6b65\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u6309\u7167\u4f20\u5165\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"key")," \u4ece etcd \u4e2d\u53d6\u51fa ReplicaSet \u5bf9\u8c61\uff0c\u7136\u540e\u53d6\u51fa\u5168\u90e8 Active \u7684 Pod\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"func (rsc *ReplicaSetController) syncReplicaSet(key string) error {\n    namespace, name, _ := cache.SplitMetaNamespaceKey(key)\n    rs, _ := rsc.rsLister.ReplicaSets(namespace).Get(name)\n\n    rsNeedsSync := rsc.expectations.SatisfiedExpectations(key)\n    selector, _ := metav1.LabelSelectorAsSelector(rs.Spec.Selector)\n\n    allPods, _ := rsc.podLister.Pods(rs.Namespace).List(labels.Everything())\n    filteredPods := controller.FilterActivePods(allPods)\n\n    filteredPods, _ = rsc.claimPods(rs, selector, filteredPods)\n\n    var manageReplicasErr error\n    if rsNeedsSync && rs.DeletionTimestamp == nil {\n        manageReplicasErr = rsc.manageReplicas(filteredPods, rs)\n    }\n    newStatus := calculateStatus(rs, filteredPods, manageReplicasErr)\n    updatedRS, _ := updateReplicaSetStatus(rsc.kubeClient.AppsV1().ReplicaSets(rs.Namespace), rs, newStatus)\n\n    return manageReplicasErr\n}\n")),(0,a.kt)("p",null,"\u968f\u540e\u6267\u884c\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"ClaimPods")," \u65b9\u6cd5\u4f1a\u83b7\u53d6\u4e00\u7cfb\u5217 Pod \u7684\u6240\u6709\u6743\uff0c\u5982\u679c\u5f53\u524d\u7684 Pod \u4e0e ReplicaSet \u7684\u9009\u62e9\u5668\u5339\u914d\u5c31\u4f1a\u5efa\u7acb\u4ece\u5c5e\u5173\u7cfb\uff0c\u5426\u5219\u5c31\u4f1a\u91ca\u653e\u6301\u6709\u7684\u5bf9\u8c61\uff0c\u6216\u8005\u76f4\u63a5\u5ffd\u89c6\u65e0\u5173\u7684 Pod\uff0c\u5efa\u7acb\u548c\u91ca\u653e\u5173\u7cfb\u7684\u65b9\u6cd5\u5c31\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"AdoptPod")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"ReleasePod"),"\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"AdoptPod")," \u4f1a\u8bbe\u7f6e\u76ee\u6807\u5bf9\u8c61\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"metadata.OwnerReferences")," \u5b57\u6bb5\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'// AdoptPod\n{\n   "metadata": {\n      "ownerReferences": [\n         {\n            "apiVersion": m.controllerKind.GroupVersion(),\n            "kind": m.controllerKind.Kind,\n            "name": m.Controller.GetName(),\n            "uid": m.Controller.GetUID(),\n            "controller": true,\n            "blockOwnerDeletion": true\n         }\n      ],\n      "uid": pod.UID\n   }\n}\n')),(0,a.kt)("p",null,"\u800c ",(0,a.kt)("inlineCode",{parentName:"p"},"ReleasePod")," \u4f1a\u4f7f\u7528\u5982\u4e0b\u7684 JSON \u6570\u636e\u5220\u9664\u76ee\u6807 Pod \u4e2d\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"metadata.OwnerReferences")," \u5c5e\u6027\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'// ReleasePod\n{\n   "metadata": {\n      "ownerReferences": [\n         {\n            "$patch":"delete",\n            "uid": m.Controller.GetUID()\n         }\n      ],\n      "uid": pod.UID\n   }\n}\n')),(0,a.kt)("p",null,"\u65e0\u8bba\u662f\u5efa\u7acb\u8fd8\u662f\u91ca\u653e\u4ece\u5c5e\u5173\u7cfb\uff0c\u90fd\u662f\u6839\u636e ReplicaSet \u7684\u9009\u62e9\u5668\u914d\u7f6e\u8fdb\u884c\u7684\uff0c\u5b83\u4eec\u6839\u636e\u5339\u914d\u7684\u6807\u7b7e\u6267\u884c\u4e0d\u540c\u7684\u64cd\u4f5c\u3002"),(0,a.kt)("p",null,"\u5728\u5bf9\u5df2\u7ecf\u5b58\u5728 Pod \u8fdb\u884c\u66f4\u65b0\u4e4b\u540e\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"manageReplicas")," \u65b9\u6cd5\u4f1a\u68c0\u67e5\u5e76\u66f4\u65b0\u5f53\u524d ReplicaSet \u6301\u6709\u7684\u526f\u672c\uff0c\u5982\u679c\u5df2\u7ecf\u5b58\u5728\u7684 Pod \u6570\u91cf\u5c0f\u4e8e ReplicaSet \u7684\u671f\u671b\u6570\u91cf\uff0c\u90a3\u4e48\u5c31\u4f1a\u6839\u636e\u6a21\u677f\u7684\u914d\u7f6e\u521b\u5efa\u4e00\u4e9b\u65b0\u7684 Pod \u5e76\u4e0e\u8fd9\u4e9b Pod \u5efa\u7acb\u4ece\u5c5e\u5173\u7cfb\uff0c\u521b\u5efa\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"slowStartBatch")," \u65b9\u6cd5\u5206\u7ec4\u6279\u91cf\u521b\u5efa Pod \u4ee5\u51cf\u5c11\u5931\u8d25\u7684\u6b21\u6570\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"func (rsc *ReplicaSetController) manageReplicas(filteredPods []*v1.Pod, rs *apps.ReplicaSet) error {\n    diff := len(filteredPods) - int(*(rs.Spec.Replicas))\n    rsKey, _ := controller.KeyFunc(rs)\n    if diff < 0 {\n        diff *= -1\n        if diff > rsc.burstReplicas {\n            diff = rsc.burstReplicas\n        }\n        successfulCreations, err := slowStartBatch(diff, controller.SlowStartInitialBatchSize, func() error {\n            boolPtr := func(b bool) *bool { return &b }\n            controllerRef := &metav1.OwnerReference{\n                APIVersion:         rsc.GroupVersion().String(),\n                Kind:               rsc.Kind,\n                Name:               rs.Name,\n                UID:                rs.UID,\n                BlockOwnerDeletion: boolPtr(true),\n                Controller:         boolPtr(true),\n            }\n            rsc.podControl.CreatePodsWithControllerRef(rs.Namespace, &rs.Spec.Template, rs, controllerRef)\n            return nil\n        })\n\n        return err\n")),(0,a.kt)("p",null,"\u5220\u9664 Pod \u7684\u65b9\u5f0f\u5c31\u662f\u5e76\u53d1\u8fdb\u884c\u7684\u4e86\uff0c\u4ee3\u7801\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"WaitGroup")," \u7b49\u5f85\u5168\u90e8\u7684\u5220\u9664\u4efb\u52a1\u8fd0\u884c\u7ed3\u675f\u624d\u4f1a\u8fd4\u56de\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"} else if diff > 0 {\n        if diff > rsc.burstReplicas {\n            diff = rsc.burstReplicas\n        }\n\n        podsToDelete := getPodsToDelete(filteredPods, diff)\n\n        var wg sync.WaitGroup\n        wg.Add(diff)\n        for _, pod := range podsToDelete {\n            go func(targetPod *v1.Pod) {\n                defer wg.Done()\n                rsc.podControl.DeletePod(rs.Namespace, targetPod.Name, rs)\n            }(pod)\n        }\n        wg.Wait()\n    }\n\n    return nil\n}\n")),(0,a.kt)("p",null,"\u5982\u679c\u9700\u8981\u5220\u9664\u5168\u90e8\u7684 Pod \u5c31\u4e0d\u5bf9\u4f20\u5165\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"filteredPods")," \u8fdb\u884c\u6392\u5e8f\uff0c\u5426\u5219\u5c31\u4f1a\u6309\u7167\u4e09\u4e2a\u4e0d\u540c\u7684\u7ef4\u5ea6\u5bf9 Pod \u8fdb\u884c\u6392\u5e8f\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"NotReady < Ready"),(0,a.kt)("li",{parentName:"ol"},"Unscheduled < Scheduled"),(0,a.kt)("li",{parentName:"ol"},"Pending < Running")),(0,a.kt)("p",null,"\u6309\u7167\u4e0a\u8ff0\u89c4\u5219\u8fdb\u884c\u6392\u5e8f\u7684 Pod \u80fd\u591f\u4fdd\u8bc1\u5220\u9664\u5728\u65e9\u671f\u9636\u6bb5\u7684 Pod \u5bf9\u8c61\uff0c\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"manageReplicas")," \u65b9\u6cd5\u4f1a\u5728\u4e0e\u5df2\u7ecf\u5b58\u5728\u7684 Pod \u5efa\u7acb\u5173\u7cfb\u4e4b\u540e\uff0c\u5bf9\u6301\u6709\u7684\u6570\u91cf\u548c\u671f\u671b\u7684\u6570\u91cf\u8fdb\u884c\u6bd4\u8f83\u4e4b\u540e\uff0c\u4f1a\u6839\u636e Pod \u6a21\u677f\u521b\u5efa\u6216\u8005\u5220\u9664 Pod:"),(0,a.kt)("p",null,"\u5230\u8fd9\u91cc\u6574\u4e2a\u5904\u7406 ReplicaSet \u7684\u4e3b\u8981\u5de5\u4f5c\u5c31\u7ed3\u675f\u4e86\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"syncReplicaSet")," \u4e2d\u5269\u4e0b\u7684\u4ee3\u7801\u4f1a\u66f4\u65b0 ReplicaSet \u7684\u72b6\u6001\u5e76\u7ed3\u675f\u540c\u6b65 ReplicaSet \u7684\u5de5\u4f5c\u3002"),(0,a.kt)("h3",{id:"2\u5220\u9664"},"2\u3001\u5220\u9664"),(0,a.kt)("p",null,"\u5982\u679c\u6211\u4eec\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u5220\u9664\u4e00\u4e2a ReplicaSet \u6301\u6709\u7684 Pod\uff0c\u90a3\u4e48\u63a7\u5236\u5668\u4f1a\u91cd\u65b0\u540c\u6b65 ReplicaSet \u7684\u72b6\u6001\u5e76\u542f\u52a8\u4e00\u4e2a\u65b0\u7684 Pod\uff0c\u4f46\u662f\u5982\u679c\u5220\u9664\u96c6\u7fa4\u4e2d\u7684 ReplicaSet \u6240\u6709\u76f8\u5173\u7684 Pod \u4e5f\u90fd\u4f1a\u88ab\u5220\u9664\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'$ kubectl delete rs example\nreplicaset.extensions "example" deleted\n\n$ kubectl get pods --watch\nexample-z4fvc   0/1       Terminating   0         54s\nexample-zswpk   0/1       Terminating   0         54s\nexample-v8wwn   0/1       Terminating   0         54s\n')),(0,a.kt)("p",null,"\u5220\u9664\u76f8\u5173 Pod \u7684\u5de5\u4f5c\u5e76\u4e0d\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"ReplicaSetController")," \u8d1f\u8d23\u7684\uff0c\u800c\u662f\u7531\u96c6\u7fa4\u4e2d\u7684 ",(0,a.kt)("a",{parentName:"p",href:"https://draveness.me/kubernetes-garbage-collector"},"\u5783\u573e\u6536\u96c6\u5668"),"\uff0c\u4e5f\u5c31\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"GarbageCollector")," \u5b9e\u73b0\u7684\u3002"),(0,a.kt)("p",null,"Kubernetes \u4e2d\u7684\u5783\u573e\u6536\u96c6\u5668\u4f1a\u8d1f\u8d23\u5220\u9664",(0,a.kt)("strong",{parentName:"p"},"\u4ee5\u524d\u6709\u6240\u6709\u8005\u4f46\u662f\u73b0\u5728\u6ca1\u6709"),"\u7684\u5bf9\u8c61\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"metadata.ownerReference")," \u5c5e\u6027\u6807\u8bc6\u4e86\u4e00\u4e2a\u5bf9\u8c61\u7684\u6240\u6709\u8005\uff0c\u5f53\u5783\u573e\u6536\u96c6\u5668\u53d1\u73b0\u5bf9\u8c61\u7684\u6240\u6709\u8005\u88ab\u5220\u9664\u65f6\uff0c\u5c31\u4f1a\u81ea\u52a8\u5220\u9664\u8fd9\u4e9b\u65e0\u7528\u7684\u5bf9\u8c61\uff0c\u8fd9\u4e5f\u662f ReplicaSet \u6301\u6709\u7684 Pod \u88ab\u81ea\u52a8\u5220\u9664\u7684\u539f\u56e0\uff0c\u6211\u4eec\u4f1a\u5728 ",(0,a.kt)("a",{parentName:"p",href:"https://draveness.me/kubernetes-garbage-collector"},"\u5783\u573e\u6536\u96c6\u5668")," \u4e00\u8282\u4e2d\u5177\u4f53\u4ecb\u7ecd\u5783\u573e\u6536\u96c6\u5668\u7684\u539f\u7406\u3002"),(0,a.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,a.kt)("p",null,"Kubernetes \u4e2d\u7684 ReplicaSet \u5e76\u4e0d\u662f\u4e00\u4e2a\u5de5\u7a0b\u5e08\u7ecf\u5e38\u9700\u8981\u76f4\u63a5\u63a5\u89e6\u7684\u5bf9\u8c61\uff0c\u5e38\u7528\u7684 Deployment \u5176\u5b9e\u4f7f\u7528 ReplicaSet \u5b9e\u73b0\u4e86\u5f88\u591a\u590d\u6742\u7684\u7279\u6027\uff0c\u4f8b\u5982\u6eda\u52a8\u66f4\u65b0\uff0c\u867d\u7136\u4f5c\u4e3a\u4f7f\u7528\u8005\u6211\u4eec\u5e76\u4e0d\u4f1a\u7ecf\u5e38\u76f4\u63a5\u4e0e ReplicaSet \u8fd9\u4e00\u5bf9\u8c61\u6253\u4ea4\u9053\uff0c\u4f46\u662f\u5982\u679c\u9700\u8981\u5bf9 Kubernetes \u8fdb\u884c\u4e00\u4e9b\u5b9a\u5236\u5316\u5f00\u53d1\uff0c\u53ef\u80fd\u4f1a\u7528 ReplicaSet \u548c\u5176\u4ed6\u5bf9\u8c61\u5b9e\u73b0\u4e00\u4e9b\u66f4\u590d\u6742\u7684\u529f\u80fd\u3002"),(0,a.kt)("h2",{id:"reference"},"Reference"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/concepts/workloads/controllers/garbage-collection/"},"Garbage Collection")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/"},"ReplicaSet"))))}d.isMDXComponent=!0}}]);