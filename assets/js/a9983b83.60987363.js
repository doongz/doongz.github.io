"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[82918],{3905:(t,e,a)=>{a.d(e,{Zo:()=>m,kt:()=>s});var r=a(67294);function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function l(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function p(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(Object(a),!0).forEach((function(e){n(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function o(t,e){if(null==t)return{};var a,r,n=function(t,e){if(null==t)return{};var a,r,n={},l=Object.keys(t);for(r=0;r<l.length;r++)a=l[r],e.indexOf(a)>=0||(n[a]=t[a]);return n}(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(r=0;r<l.length;r++)a=l[r],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(n[a]=t[a])}return n}var d=r.createContext({}),i=function(t){var e=r.useContext(d),a=e;return t&&(a="function"==typeof t?t(e):p(p({},e),t)),a},m=function(t){var e=i(t.components);return r.createElement(d.Provider,{value:e},t.children)},k="mdxType",c={inlineCode:"code",wrapper:function(t){var e=t.children;return r.createElement(r.Fragment,{},e)}},u=r.forwardRef((function(t,e){var a=t.components,n=t.mdxType,l=t.originalType,d=t.parentName,m=o(t,["components","mdxType","originalType","parentName"]),k=i(a),u=n,s=k["".concat(d,".").concat(u)]||k[u]||c[u]||l;return a?r.createElement(s,p(p({ref:e},m),{},{components:a})):r.createElement(s,p({ref:e},m))}));function s(t,e){var a=arguments,n=e&&e.mdxType;if("string"==typeof t||n){var l=a.length,p=new Array(l);p[0]=u;var o={};for(var d in e)hasOwnProperty.call(e,d)&&(o[d]=e[d]);o.originalType=t,o[k]="string"==typeof t?t:n,p[1]=o;for(var i=2;i<l;i++)p[i]=a[i];return r.createElement.apply(null,p)}return r.createElement.apply(null,a)}u.displayName="MDXCreateElement"},58027:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>d,contentTitle:()=>p,default:()=>k,frontMatter:()=>l,metadata:()=>o,toc:()=>i});var r=a(87462),n=(a(67294),a(3905));const l={},p="ceph CLI",o={unversionedId:"Skill/\u5e38\u7528CLI/ceph-CLI",id:"Skill/\u5e38\u7528CLI/ceph-CLI",title:"ceph CLI",description:"apt install ceph-common",source:"@site/docs/Skill/\u5e38\u7528CLI/3-ceph-CLI.md",sourceDirName:"Skill/\u5e38\u7528CLI",slug:"/Skill/\u5e38\u7528CLI/ceph-CLI",permalink:"/docs/Skill/\u5e38\u7528CLI/ceph-CLI",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"skillSidebar",previous:{title:"k8s CLI",permalink:"/docs/Skill/\u5e38\u7528CLI/k8s-CLI"},next:{title:"echo",permalink:"/docs/Skill/\u5e38\u7528CLI/\u5f85\u6574\u7406-linux\u547d\u4ee4/echo"}},d={},i=[{value:"\u4e00\u3001ceph \u76f8\u5173\u547d\u4ee4",id:"\u4e00ceph-\u76f8\u5173\u547d\u4ee4",level:2},{value:"\u4e8c\u3001rbd \u76f8\u5173\u547d\u4ee4",id:"\u4e8crbd-\u76f8\u5173\u547d\u4ee4",level:2},{value:"1\u3001\u67e5\u770b",id:"1\u67e5\u770b",level:3},{value:"2\u3001\u521b\u5efa",id:"2\u521b\u5efa",level:3},{value:"3\u3001\u5220\u9664",id:"3\u5220\u9664",level:3}],m={toc:i};function k(t){let{components:e,...a}=t;return(0,n.kt)("wrapper",(0,r.Z)({},m,a,{components:e,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"ceph-cli"},"ceph CLI"),(0,n.kt)("p",null,"apt install ceph-common"),(0,n.kt)("p",null,"ceph.conf \u653e\u5230 /etc/ceph"),(0,n.kt)("h2",{id:"\u4e00ceph-\u76f8\u5173\u547d\u4ee4"},"\u4e00\u3001ceph \u76f8\u5173\u547d\u4ee4"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"\u547d\u4ee4"),(0,n.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"ceph -s"),(0,n.kt)("td",{parentName:"tr",align:null},"\u770bceph\u72b6\u6001")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"ceph df"),(0,n.kt)("td",{parentName:"tr",align:null},"\u770b\u5b58\u50a8\u4f7f\u7528\u72b6\u6001")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"ceph osd tree"),(0,n.kt)("td",{parentName:"tr",align:null},"\u67e5\u770b\u6709\u591a\u5c11osd")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"ceph osd lspools"),(0,n.kt)("td",{parentName:"tr",align:null},"\u770b\u5b58\u50a8\u6c60")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"ceph osd pool create <pool_name> <pg_num> <pgp_num>"),(0,n.kt)("td",{parentName:"tr",align:null},"\u521b\u5efa\u5b58\u50a8\u6c60")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"ceph osd pool set <pool_name> size <\u5907\u4efd\u6570>"),(0,n.kt)("td",{parentName:"tr",align:null},"\u8bbe\u7f6e\u5907\u4efd\u6570")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"ceph osd pool set <pool_name> size <\u5907\u4efd\u6570>"),(0,n.kt)("td",{parentName:"tr",align:null},"\u8bbe\u7f6e\u5907\u4efd\u6570")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"ceph osd pool get <pool_name> size"),(0,n.kt)("td",{parentName:"tr",align:null},"\u67e5\u770b\u5907\u4efd\u6570")))),(0,n.kt)("p",null,"\u521b\u5efa\u5b58\u50a8\u6c60\u547d\u4ee4\u8be6\u89e3\uff1a"),(0,n.kt)("p",null,"pgp_num\u8ddfpg_num\u4fdd\u6301\u4e00\u81f4, pg_num = ((osd_num * 100) / \u5907\u4efd\u6570) -> \u518d\u5411\u4e0a\u53d62\u7684\u5e42\u6b21\u65b9\uff0c\u4f8b\u5982\uff0c\u8ba1\u7b97\u4ee5\u540e=1000\uff0c\u5219\u53d6\u503c1024"),(0,n.kt)("h2",{id:"\u4e8crbd-\u76f8\u5173\u547d\u4ee4"},"\u4e8c\u3001rbd \u76f8\u5173\u547d\u4ee4"),(0,n.kt)("h3",{id:"1\u67e5\u770b"},"1\u3001\u67e5\u770b"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"\u547d\u4ee4"),(0,n.kt)("th",{parentName:"tr",align:"left"},"\u63cf\u8ff0"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd ls user_pool"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u67e5\u770b\u8d44\u6e90\u6c60\u91cc\u9762\u7684\u955c\u50cf")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd info user_pool/zd_image"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u67e5\u770b\u955c\u50cf\u7684\u5177\u4f53\u4fe1\u606f")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd du <pool_name>/<volume_name>"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u67e5\u770b\u5377\u5b9e\u9645\u4f7f\u7528\u5927\u5c0f")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd snap ls user_pool/zd_image"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u67e5\u770b\u8be5\u955c\u50cf\u4e0b\u7684\u5feb\u7167")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd showmapped"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u67e5\u770b\u672c\u673a\u4e0a\u6302\u8f7d\u7684rbd\u8bbe\u5907\uff0c\u914d\u5408grep\u53ef\u4ee5\u67e5")))),(0,n.kt)("h3",{id:"2\u521b\u5efa"},"2\u3001\u521b\u5efa"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"\u547d\u4ee4"),(0,n.kt)("th",{parentName:"tr",align:"left"},"\u63cf\u8ff0"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd create user_pool/zd_image --size 100"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u5efa\u4e2a100M\u7684\u955c\u50cf\uff08\u5377\uff09")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd map user_pool/zd_image",(0,n.kt)("br",null),"mkfs -t ext4 /dev/rbd0",(0,n.kt)("br",null),"mount /dev/rbd0 /mnt"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u8f93\u51fa\uff1a/dev/rbd0",(0,n.kt)("br",null),"\u6302\u8f7d\u5230\u672c\u5730\u4f7f\u7528")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd snap create user_pool/zd_image@zd_snap"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u521b\u5efa\u5feb\u7167")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd snap protect user_pool/zd_image@zd_snap"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u4fdd\u62a4\u5feb\u7167\u540e")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd clone user_pool/zd_image@zd_snap user_pool/zd_image_snap_clone"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u624d\u80fd\u5236\u4f5c\u514b\u9686\u5377")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd flatten rbd/zd_image_snap_clone"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u5c06\u4e00\u4e2a\u514b\u9686\u5377flatter\u540e\uff0c\u8be5\u514b\u9686\u5377\u4e0e\u7236\u955c\u50cf\u89e3\u9664\u5173\u7cfb\uff0c\u6210\u4e3a\u72ec\u7acb\u955c\u50cf")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd copy user_pool/zd_image user_pool/zd_copy_image"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u62f7\u8d1d\u4e00\u4e2a\u955c\u50cf\uff0c\u62f7\u8d1d\u7684\u955c\u50cf\u4e0d\u7ee7\u627f\u7236\u5b50\u5173\u7cfb")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd deep copy user_pool/zd_image user_pool/zd_deep_copy_image"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u62f7\u8d1d\u4e00\u4e2a\u955c\u50cf\uff0c\u62f7\u8d1d\u7684\u955c\u50cf\u7ee7\u627f\u7236\u5b50\u5173\u7cfb")))),(0,n.kt)("h3",{id:"3\u5220\u9664"},"3\u3001\u5220\u9664"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"\u547d\u4ee4"),(0,n.kt)("th",{parentName:"tr",align:"left"},"\u63cf\u8ff0"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd unmap /dev/rbd10"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u5728\u672c\u673a\u4e0a\u5378\u8f7d\u5757\u8bbe\u5907\uff0c-o force \u5f3a\u5236\u5220\u9664")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd rm user_pool/zd_image"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u5220\u9664\u955c\u50cf")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd snap rm user_pool/zd_image@zd_snap"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u5220\u9664\u5feb\u7167")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"rbd snap unprotect user_pool/zd_image@zd_snap"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u5feb\u7167\u53bb\u4fdd\u62a4")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"ceph osd pool delete user_pool user_pool --yes-i-really-really-mean-it"),(0,n.kt)("td",{parentName:"tr",align:"left"},"\u5220\u9664\u5b58\u50a8\u6c60")))))}k.isMDXComponent=!0}}]);